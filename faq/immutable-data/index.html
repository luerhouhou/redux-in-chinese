<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-faq/immutable-data">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-66122997-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M7SNC3FDW9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-M7SNC3FDW9",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Redux 中文官网" href="/opensearch.xml"><title data-rh="true">Immutable Data | Redux 中文官网</title><meta data-rh="true" property="og:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" name="twitter:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" property="og:url" content="http://cn.redux.js.org/faq/immutable-data"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Immutable Data | Redux 中文官网"><meta data-rh="true" name="description" content="Table of Contents"><meta data-rh="true" property="og:description" content="Table of Contents"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="http://cn.redux.js.org/faq/immutable-data"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/faq/immutable-data" hreflang="en"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/faq/immutable-data" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f2db9367.css">
<link rel="preload" href="/assets/js/runtime~main.29e80f7a.js" as="script">
<link rel="preload" href="/assets/js/main.7ecee670.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Redux 中文官网</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction/getting-started">入门</a><a class="navbar__item navbar__link" href="/tutorials/essentials/part-1-overview-concepts">教程</a><a class="navbar__item navbar__link" href="/api/api-reference">API</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/faq">常见问题</a><a class="navbar__item navbar__link" href="/style-guide/style-guide">最佳实践</a><a href="https://www.github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">源码<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/nefe/redux-in-chinese/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">纠错</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/getting-started">简介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/tutorials/index">教程</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/usage/">使用指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/understanding/thinking-in-redux/motivation">深入理解 Redux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/faq">常见问题</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq">FAQ 目录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/general">General</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/reducers">Reducers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/organizing-state">Organizing State</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/store-setup">Store Setup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/actions">Actions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/faq/immutable-data">Immutable Data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/code-structure">Code Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/performance">Performance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/design-decisions">Design Decisions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/react-redux">React Redux</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/faq/miscellaneous">Miscellaneous</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/style-guide/">编码规范</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/api/api-reference">API 文档</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redux-toolkit/overview">Redux Toolkit</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">常见问题</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Immutable Data</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Redux FAQ: Immutable Data</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="table-of-contents">Table of Contents<a class="hash-link" href="#table-of-contents" title="Direct link to heading">​</a></h2><ul><li><a href="#what-are-the-benefits-of-immutability">What are the benefits of immutability?</a></li><li><a href="#why-is-immutability-required-by-redux">Why is immutability required by Redux?</a></li><li><a href="#why-does-reduxs-use-of-shallow-equality-checking-require-immutability">Why does Redux’s use of shallow equality checking require immutability?</a><ul><li><a href="#how-do-shallow-and-deep-equality-checking-differ">How do Shallow and Deep Equality Checking differ?</a></li><li><a href="#how-does-redux-use-shallow-equality-checking">How does Redux use shallow equality checking?</a></li><li><a href="#how-does-combinereducers-use-shallow-equality-checking">How does <code>combineReducers</code> use shallow equality checking?</a></li><li><a href="#how-does-react-redux-use-shallow-equality-checking">How does React-Redux use shallow equality checking?</a></li><li><a href="#how-does-react-redux-use-shallow-equality-checking-to-determine-whether-a-component-needs-re-rendering">How does React-Redux use shallow equality checking to determine whether a component needs re-rendering?</a></li><li><a href="#why-will-shallow-equality-checking-not-work-with-mutable-objects">Why will shallow equality checking not work with mutable objects?</a></li><li><a href="#does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux">Does shallow equality checking with a mutable object cause problems with Redux?</a></li><li><a href="#why-does-a-reducer-mutating-the-state-prevent-react-redux-from-re-rendering-a-wrapped-component">Why does a reducer mutating the state prevent React-Redux from re-rendering a wrapped component?</a></li><li><a href="#why-does-a-selector-mutating-and-returning-a-persistent-object-to-mapstatetoprops-prevent-react-redux-from-re-rendering-a-wrapped-component">Why does a selector mutating and returning a persistent object to <code>mapStateToProps</code> prevent React-Redux from re-rendering a wrapped component?</a></li><li><a href="#how-does-immutability-enable-a-shallow-check-to-detect-object-mutations">How does immutability enable a shallow check to detect object mutations?</a></li><li><a href="#how-can-immutability-in-your-reducers-cause-components-to-render-unnecessarily">How can immutability in your reducers cause components to render unnecessarily?</a></li><li><a href="#how-can-immutability-in-mapstatetoprops-cause-components-to-render-unnecessarily">How can immutability in mapStateToProps cause components to render unnecessarily?</a></li></ul></li><li><a href="#what-approaches-are-there-for-handling-data-immutability-do-i-have-to-use-immer">What approaches are there for handling data immutability? Do I have to use Immer?</a></li><li><a href="#what-are-the-issues-with-using-plain-javascript-for-immutable-operations">What are the issues with using JavaScript for immutable operations?</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-the-benefits-of-immutability">What are the benefits of immutability?<a class="hash-link" href="#what-are-the-benefits-of-immutability" title="Direct link to heading">​</a></h2><p>Immutability can bring increased performance to your app, and leads to simpler programming and debugging, as data that never changes is easier to reason about than data that is free to be changed arbitrarily throughout your app.</p><p>In particular, immutability in the context of a Web app enables sophisticated change detection techniques to be implemented simply and cheaply, ensuring the computationally expensive process of updating the DOM occurs only when it absolutely has to (a cornerstone of React’s performance improvements over other libraries).</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information">Further information<a class="hash-link" href="#further-information" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">Introduction to Immer</a></li><li><a href="https://www.jfokus.se/jfokus16/preso/JavaScript-Immutability--Dont-Go-Changing.pdf" target="_blank" rel="noopener noreferrer">JavaScript Immutability presentation (PDF - see slide 12 for benefits)</a></li><li><a href="https://facebook.github.io/react/docs/optimizing-performance.html" target="_blank" rel="noopener noreferrer">React: Optimizing Performance</a></li><li><a href="https://medium.com/google-developers/javascript-application-architecture-on-the-road-to-2015-d8125811101b#.djje0rfys" target="_blank" rel="noopener noreferrer">JavaScript Application Architecture On The Road To 2015</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-is-immutability-required-by-redux">Why is immutability required by Redux?<a class="hash-link" href="#why-is-immutability-required-by-redux" title="Direct link to heading">​</a></h2><ul><li>Both Redux and React-Redux employ <a href="#how-do-shallow-and-deep-equality-checking-differ">shallow equality checking</a>. In particular: - Redux&#x27;s <code>combineReducers</code> utility <a href="#how-does-redux-use-shallow-equality-checking">shallowly checks for reference changes</a> caused by the reducers that it calls. - React-Redux&#x27;s <code>connect</code> method generates components that <a href="#how-does-react-redux-use-shallow-equality-checking">shallowly check reference changes to the root state</a>, and the return values from the <code>mapStateToProps</code> function to see if the wrapped components actually need to re-render.
Such <a href="#why-will-shallow-equality-checking-not-work-with-mutable-objects">shallow checking requires immutability</a> to function correctly.</li><li>Immutable data management ultimately makes data handling safer.</li><li>Time-travel debugging requires that reducers be pure functions with no side effects, so that you can correctly jump between different states.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-1">Further Information<a class="hash-link" href="#further-information-1" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="/recipes/structuring-reducers/prerequisite-concepts">Recipes: Prerequisite Reducer Concepts</a></li></ul><p><strong>Discussions</strong></p><ul><li><a href="https://www.reddit.com/r/reactjs/comments/5ecqqv/why_redux_need_reducers_to_be_pure_functions/dacmmjh/?context=3" target="_blank" rel="noopener noreferrer">Reddit: Why Redux Needs Reducers To Be Pure Functions</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-reduxs-use-of-shallow-equality-checking-require-immutability">Why does Redux’s use of shallow equality checking require immutability?<a class="hash-link" href="#why-does-reduxs-use-of-shallow-equality-checking-require-immutability" title="Direct link to heading">​</a></h2><p>Redux&#x27;s use of shallow equality checking requires immutability if any connected components are to be updated correctly. To see why, we need to understand the difference between shallow and deep equality checking in JavaScript.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-do-shallow-and-deep-equality-checking-differ">How do shallow and deep equality checking differ?<a class="hash-link" href="#how-do-shallow-and-deep-equality-checking-differ" title="Direct link to heading">​</a></h3><p>Shallow equality checking (or <em>reference equality</em>) simply checks that two different <em>variables</em> reference the same object; in contrast, deep equality checking (or <em>value equality</em>) must check every <em>value</em> of two objects&#x27; properties.</p><p>A shallow equality check is therefore as simple (and as fast) as <code>a === b</code>, whereas a deep equality check involves a recursive traversal through the properties of two objects, comparing the value of each property at each step.</p><p>It&#x27;s for this improvement in performance that Redux uses shallow equality checking.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-2">Further Information<a class="hash-link" href="#further-information-2" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/" target="_blank" rel="noopener noreferrer">Pros and Cons of using immutability with React.js</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-redux-use-shallow-equality-checking">How does Redux use shallow equality checking?<a class="hash-link" href="#how-does-redux-use-shallow-equality-checking" title="Direct link to heading">​</a></h3><p>Redux uses shallow equality checking in its <code>combineReducers</code> function to return either a new mutated copy of the root state object, or, if no mutations have been made, the current root state object.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-3">Further Information<a class="hash-link" href="#further-information-3" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="/api/combinereducers">API: combineReducers</a></li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-combinereducers-use-shallow-equality-checking">How does <code>combineReducers</code> use shallow equality checking?<a class="hash-link" href="#how-does-combinereducers-use-shallow-equality-checking" title="Direct link to heading">​</a></h4><p>The <a href="/faq/reducers#reducers-share-state">suggested structure</a> for a Redux store is to split the state object into multiple &quot;slices&quot; or &quot;domains&quot; by key, and provide a separate reducer function to manage each individual data slice.</p><p><code>combineReducers</code> makes working with this style of structure easier by taking a <code>reducers</code> argument that’s defined as a hash table comprising a set of key/value pairs, where each key is the name of a state slice, and the corresponding value is the reducer function that will act on it.</p><p>So, for example, if your state shape is <code>{ todos, counter }</code>, the call to <code>combineReducers</code> would be:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">combineReducers</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> myTodosReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">counter</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> myCounterReducer </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>where:</p><ul><li>the keys <code>todos</code> and <code>counter</code> each refer to a separate state slice;</li><li>the values <code>myTodosReducer</code> and <code>myCounterReducer</code> are reducer functions, with each acting on the state slice identified by the respective key.</li></ul><p><code>combineReducers</code> iterates through each of these key/value pairs. For each iteration, it:</p><ul><li>creates a reference to the current state slice referred to by each key;</li><li>calls the appropriate reducer and passes it the slice;</li><li>creates a reference to the possibly-mutated state slice that&#x27;s returned by the reducer.</li></ul><p>As it continues through the iterations, <code>combineReducers</code> will construct a new state object with the state slices returned from each reducer. This new state object may or may not be different from the current state object. It is here that <code>combineReducers</code> uses shallow equality checking to determine whether the state has changed.</p><p>Specifically, at each stage of the iteration, <code>combineReducers</code> performs a shallow equality check on the current state slice and the state slice returned from the reducer. If the reducer returns a new object, the shallow equality check will fail, and <code>combineReducers</code> will set a <code>hasChanged</code> flag to true.</p><p>After the iterations have completed, <code>combineReducers</code> will check the state of the <code>hasChanged</code> flag. If it’s true, the newly-constructed state object will be returned. If it’s false, the <em>current</em> state object is returned.</p><p>This is worth emphasizing: <em>If the reducers all return the same <code>state</code> object passed to them, then <code>combineReducers</code> will return the <em>current</em> root state object, not the newly updated one.</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-4">Further Information<a class="hash-link" href="#further-information-4" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="/api/combinereducers">API: combineReducers</a></li><li><a href="/faq/reducers#reducers-share-state">Redux FAQ - How do I share state between two reducers? do I have to use <code>combineReducers</code>?</a></li></ul><p><strong>Video</strong></p><ul><li><a href="https://egghead.io/lessons/javascript-redux-implementing-combinereducers-from-scratch" target="_blank" rel="noopener noreferrer">Egghead.io: Redux: Implementing combineReducers() from Scratch</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-react-redux-use-shallow-equality-checking">How does React-Redux use shallow equality checking?<a class="hash-link" href="#how-does-react-redux-use-shallow-equality-checking" title="Direct link to heading">​</a></h3><p>React-Redux uses shallow equality checking to determine whether the component it’s wrapping needs to be re-rendered.</p><p>To do this, it assumes that the wrapped component is pure; that is, that the component will produce the <a href="https://react-redux.js.org/troubleshooting#my-views-aren-t-updating-when-something-changes-outside-of-redux" target="_blank" rel="noopener noreferrer">same results given the same props and state</a>.</p><p>By assuming the wrapped component is pure, it need only check whether the root state object or the values returned from <code>mapStateToProps</code> have changed. If they haven’t, the wrapped component does not need re-rendering.</p><p>It detects a change by keeping a reference to the root state object, and a reference to <em>each value</em> in the props object that&#x27;s returned from the <code>mapStateToProps</code> function.</p><p>It then runs a shallow equality check on its reference to the root state object and the state object passed to it, and a separate series of shallow checks on each reference to the props object’s values and those that are returned from running the <code>mapStateToProps</code> function again.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-5">Further Information<a class="hash-link" href="#further-information-5" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="https://react-redux.js.org" target="_blank" rel="noopener noreferrer">React-Redux Bindings</a></li></ul><p><strong>Articles</strong></p><ul><li><a href="https://react-redux.js.org/using-react-redux/connect-mapstate" target="_blank" rel="noopener noreferrer">API: React-Redux’s connect function and <code>mapStateToProps</code></a></li><li><a href="/faq/react-redux#why-isnt-my-component-re-rendering-or-my-mapstatetoprops-running">Redux FAQ: Why isn&#x27;t my component re-rendering, or my <code>mapStateToProps</code> running?</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-react-redux-shallowly-check-each-value-within-the-props-object-returned-from-mapstatetoprop">Why does React-Redux shallowly check each value within the props object returned from <code>mapStateToProp</code>?<a class="hash-link" href="#why-does-react-redux-shallowly-check-each-value-within-the-props-object-returned-from-mapstatetoprop" title="Direct link to heading">​</a></h3><p>React-Redux performs a shallow equality check on each <em>value</em> within the props object, not on the props object itself.</p><p>It does so because the props object is actually a hash of prop names and their values (or selector functions that are used to retrieve or generate the values), such as in this example:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// prop value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">visibleTodos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getVisibleTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">connect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token maybe-class-name">TodoApp</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As such, a shallow equality check of the props object returned from repeated calls to <code>mapStateToProps</code> would always fail, as a new object would be returned each time.</p><p>React-Redux therefore maintains separate references to each <em>value</em> in the returned props object.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-6">Further Information<a class="hash-link" href="#further-information-6" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f#.gh07cm24f" target="_blank" rel="noopener noreferrer">React.js pure render performance anti-pattern</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-react-redux-use-shallow-equality-checking-to-determine-whether-a-component-needs-re-rendering">How does React-Redux use shallow equality checking to determine whether a component needs re-rendering?<a class="hash-link" href="#how-does-react-redux-use-shallow-equality-checking-to-determine-whether-a-component-needs-re-rendering" title="Direct link to heading">​</a></h3><p>Each time React-Redux’s <code>connect</code> function is called, it will perform a shallow equality check on its stored reference to the root state object, and the current root state object passed to it from the store. If the check passes, the root state object has not been updated, and so there is no need to re-render the component, or even call <code>mapStateToProps</code>.</p><p>If the check fails, however, the root state object <em>has</em> been updated, and so <code>connect</code> will call <code>mapStateToProps</code>to see if the props for the wrapped component have been updated.</p><p>It does this by performing a shallow equality check on each value within the object individually, and will only trigger a re-render if one of those checks fails.</p><p>In the example below, if <code>state.todos</code> and the value returned from <code>getVisibleTodos()</code> do not change on successive calls to <code>connect</code>, then the component will not re-render .</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// prop value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">visibleTodos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getVisibleTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// selector</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">connect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token maybe-class-name">TodoApp</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Conversely, in this next example (below), the component will <em>always</em> re-render, as the value of <code>todos</code> is always a new object, regardless of whether or not its values change:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// AVOID - will always cause a re-render</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// todos always references a newly-created object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">all</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">visibleTodos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getVisibleTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">connect</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token maybe-class-name">TodoApp</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the shallow equality check fails between the new values returned from <code>mapStateToProps</code> and the previous values that React-Redux kept a reference to, then a re-rendering of the component will be triggered.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-7">Further Information<a class="hash-link" href="#further-information-7" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://blog.isquaredsoftware.com/2017/01/practical-redux-part-6-connected-lists-forms-and-performance/" target="_blank" rel="noopener noreferrer">Practical Redux, Part 6: Connected Lists, Forms, and Performance</a></li><li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f#.sb708slq6" target="_blank" rel="noopener noreferrer">React.js Pure Render Performance Anti-Pattern</a></li><li><a href="https://somebody32.github.io/high-performance-redux/" target="_blank" rel="noopener noreferrer">High Performance Redux Apps</a></li></ul><p><strong>Discussions</strong></p><ul><li><a href="https://github.com/reduxjs/redux/issues/1816" target="_blank" rel="noopener noreferrer">#1816: Component connected to state with <code>mapStateToProps</code></a></li><li><a href="https://github.com/reduxjs/react-redux/issues/300" target="_blank" rel="noopener noreferrer">#300: Potential connect() optimization</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-will-shallow-equality-checking-not-work-with-mutable-objects">Why will shallow equality checking not work with mutable objects?<a class="hash-link" href="#why-will-shallow-equality-checking-not-work-with-mutable-objects" title="Direct link to heading">​</a></h3><p>Shallow equality checking cannot be used to detect if a function mutates an object passed into it if that object is mutable.</p><p>This is because two variables that reference the same object will <em>always</em> be equal, regardless of whether the object’s values changes or not, as they&#x27;re both referencing the same object. Thus, the following will always return true:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mutateObj</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">obj</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  obj</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">key</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;newValue&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> obj</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> param </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">key</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;originalValue&#x27;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> returnVal </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mutateObj</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">param</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">param </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> returnVal</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//&gt; true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The shallow check of <code>param</code> and <code>returnValue</code> simply checks whether both variables reference the same object, which they do.<code>mutateObj()</code> may return a mutated version of <code>obj</code>, but it&#x27;s still the same object as that passed in. The fact that its values have been changed within <code>mutateObj</code> matters not at all to a shallow check.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-8">Further Information<a class="hash-link" href="#further-information-8" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/" target="_blank" rel="noopener noreferrer">Pros and Cons of using immutability with React.js</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux">Does shallow equality checking with a mutable object cause problems with Redux?<a class="hash-link" href="#does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux" title="Direct link to heading">​</a></h3><p>Shallow equality checking with a mutable object will not cause problems with Redux, but <a href="#shallow-checking-problems-with-react-redux">it will cause problems with libraries that depend on the store, such as React-Redux</a>.</p><p>Specifically, if the state slice passed to a reducer by <code>combineReducers</code> is a mutable object, the reducer can modify it directly and return it.</p><p>If it does, the shallow equality check that <code>combineReducers</code> performs will always pass, as the values of the state slice returned by the reducer may have been mutated, but the object itself has not - it’s still the same object that was passed to the reducer.</p><p>Accordingly, <code>combineReducers</code> will not set its <code>hasChanged</code> flag, even though the state has changed. If none of the other reducers return a new, updated state slice, the <code>hasChanged</code> flag will remain set to false, causing <code>combineReducers</code> to return the <em>existing</em> root state object.</p><p>The store will still be updated with the new values for the root state, but because the root state object itself is still the same object, libraries that bind to Redux, such as React-Redux, will not be aware of the state’s mutation, and so will not trigger a wrapped component’s re-rendering.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-9">Further Information<a class="hash-link" href="#further-information-9" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="/recipes/structuring-reducers/immutable-update-patterns">Recipes: Immutable Update Patterns</a></li><li><a href="/recipes/troubleshooting#never-mutate-reducer-arguments">Troubleshooting: Never mutate reducer arguments</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-a-reducer-mutating-the-state-prevent-react-redux-from-re-rendering-a-wrapped-component">Why does a reducer mutating the state prevent React-Redux from re-rendering a wrapped component?<a class="hash-link" href="#why-does-a-reducer-mutating-the-state-prevent-react-redux-from-re-rendering-a-wrapped-component" title="Direct link to heading">​</a></h3><p>If a Redux reducer directly mutates, and returns, the state object passed into it, the values of the root state object will change, but the object itself will not.</p><p>Because React-Redux performs a shallow check on the root state object to determine if its wrapped components need re-rendering or not, it will not be able to detect the state mutation, and so will not trigger a re-rendering.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-10">Further Information<a class="hash-link" href="#further-information-10" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="https://react-redux.js.org/troubleshooting#my-views-aren-t-updating-when-something-changes-outside-of-redux" target="_blank" rel="noopener noreferrer">Troubleshooting: My views aren’t updating when something changes outside of Redux</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="why-does-a-selector-mutating-and-returning-a-persistent-object-to-mapstatetoprops-prevent-react-redux-from-re-rendering-a-wrapped-component">Why does a selector mutating and returning a persistent object to <code>mapStateToProps</code> prevent React-Redux from re-rendering a wrapped component?<a class="hash-link" href="#why-does-a-selector-mutating-and-returning-a-persistent-object-to-mapstatetoprops-prevent-react-redux-from-re-rendering-a-wrapped-component" title="Direct link to heading">​</a></h3><p>If one of the values of the props object returned from <code>mapStateToProps</code> is an object that persists across calls to <code>connect</code> (such as, potentially, the root state object), yet is directly mutated and returned by a selector function, React-Redux will not be able to detect the mutation, and so will not trigger a re-render of the wrapped component.</p><p>As we’ve seen, the values in the mutable object returned by the selector function may have changed, but the object itself has not, and shallow equality checking only compares the objects themselves, not their values.</p><p>For example, the following <code>mapStateToProps</code> function will never trigger a re-render:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// State object held in the Redux store</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> state </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">user</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">accessCount</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">name</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;keith&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Selector function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">getUser</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#F8F8F2">++</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">user</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">accessCount</span><span class="token plain"> </span><span class="token comment" style="color:#c6cad2">// mutate the state object</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// mapStateToProps</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">mapStateToProps</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// The object returned from getUser() is always</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// the same object, so this wrapped</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// component will never re-render, even though it&#x27;s been</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// mutated</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">userRecord</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getUser</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> a </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> b </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">userRecord</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> b</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">userRecord</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//&gt; true</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that, conversely, if an <em>immutable</em> object is used, the <a href="#immutability-issues-with-react-redux">component may re-render when it should not</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-11">Further Information<a class="hash-link" href="#further-information-11" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://blog.isquaredsoftware.com/2017/01/practical-redux-part-6-connected-lists-forms-and-performance/" target="_blank" rel="noopener noreferrer">Practical Redux, Part 6: Connected Lists, Forms, and Performance</a></li></ul><p><strong>Discussions</strong></p><ul><li><a href="https://github.com/reduxjs/redux/issues/1948" target="_blank" rel="noopener noreferrer">#1948: Is getMappedItems an anti-pattern in mapStateToProps?</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-does-immutability-enable-a-shallow-check-to-detect-object-mutations">How does immutability enable a shallow check to detect object mutations?<a class="hash-link" href="#how-does-immutability-enable-a-shallow-check-to-detect-object-mutations" title="Direct link to heading">​</a></h3><p>If an object is immutable, any changes that need to be made to it within a function must be made to a <em>copy</em> of the object.</p><p>This mutated copy is a <em>separate</em> object from that passed into the function, and so when it is returned, a shallow check will identify it as being a different object from that passed in, and so will fail.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-12">Further Information<a class="hash-link" href="#further-information-12" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/" target="_blank" rel="noopener noreferrer">Pros and Cons of using immutability with React.js</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-immutability-in-your-reducers-cause-components-to-render-unnecessarily">How can immutability in your reducers cause components to render unnecessarily?<a class="hash-link" href="#how-can-immutability-in-your-reducers-cause-components-to-render-unnecessarily" title="Direct link to heading">​</a></h3><p>You cannot mutate an immutable object; instead, you must mutate a copy of it, leaving the original intact.</p><p>That’s perfectly OK when you mutate the copy, but in the context of a reducer, if you return a copy that <em>hasn’t</em> been mutated, Redux’s <code>combineReducers</code> function will still think that the state needs to be updated, as you&#x27;re returning an entirely different object from the state slice object that was passed in.</p><p><code>combineReducers</code> will then return this new root state object to the store. The new object will have the same values as the current root state object, but because it&#x27;s a different object, it will cause the store to be updated, which will ultimately cause all connected components to be re-rendered unnecessarily.</p><p>To prevent this from happening, you must <em>always return the state slice object that’s passed into a reducer if the reducer does not mutate the state.</em></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-13">Further Information<a class="hash-link" href="#further-information-13" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f#.5hmnwygsy" target="_blank" rel="noopener noreferrer">React.js pure render performance anti-pattern</a></li><li><a href="https://www.toptal.com/react/react-redux-and-immutablejs" target="_blank" rel="noopener noreferrer">Building Efficient UI with React and Redux</a></li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="how-can-immutability-in-mapstatetoprops-cause-components-to-render-unnecessarily">How can immutability in <code>mapStateToProps</code> cause components to render unnecessarily?<a class="hash-link" href="#how-can-immutability-in-mapstatetoprops-cause-components-to-render-unnecessarily" title="Direct link to heading">​</a></h3><p>Certain immutable operations, such as an Array filter, will always return a new object, even if the values themselves have not changed.</p><p>If such an operation is used as a selector function in <code>mapStateToProps</code>, the shallow equality check that React-Redux performs on each value
in the props object that’s returned will always fail, as the selector is returning a new object each time.</p><p>As such, even though the values of that new object have not changed, the wrapped component will always be re-rendered,</p><p>For example, the following will always trigger a re-render:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// A JavaScript array&#x27;s &#x27;filter&#x27; method treats the array as immutable,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// and returns a filtered copy of the array.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">getVisibleTodos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">filter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">t</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">!</span><span class="token plain">t</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">completed</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> state </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">todos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">text</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;do todo 1&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">false</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">text</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;do todo 2&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">completed</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token boolean" style="color:#AE81FF">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">mapStateToProps</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// getVisibleTodos() always returns a new array, and so the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// &#x27;visibleToDos&#x27; prop will always reference a different array,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// causing the wrapped component to re-render, even if the array&#x27;s</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// values haven&#x27;t changed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">visibleToDos</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getVisibleTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> a </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//  Call mapStateToProps(state) again with exactly the same arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> b </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">mapStateToProps</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">visibleToDos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//&gt; { &quot;completed&quot;: false, &quot;text&quot;: &quot;do todo 1&quot; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">b</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">visibleToDos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//&gt; { &quot;completed&quot;: false, &quot;text&quot;: &quot;do todo 1&quot; }</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">a</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">visibleToDos</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> b</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">visibleToDos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">//&gt; false</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that, conversely, if the values in your props object refer to mutable objects, <a href="#shallow-checking-stops-component-re-rendering">your component may not render when it should</a>.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-14">Further Information<a class="hash-link" href="#further-information-14" title="Direct link to heading">​</a></h4><p><strong>Articles</strong></p><ul><li><a href="https://medium.com/@esamatti/react-js-pure-render-performance-anti-pattern-fb88c101332f#.b8bpx1ncj" target="_blank" rel="noopener noreferrer">React.js pure render performance anti-pattern</a></li><li><a href="https://www.toptal.com/react/react-redux-and-immutablejs" target="_blank" rel="noopener noreferrer">Building Efficient UI with React and Redux</a></li><li><a href="https://medium.com/@AlexFaunt/immutablejs-worth-the-price-66391b8742d4#.a3alci2g8" target="_blank" rel="noopener noreferrer">ImmutableJS: worth the price?</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-approaches-are-there-for-handling-data-immutability-do-i-have-to-use-immer">What approaches are there for handling data immutability? Do I have to use Immer?<a class="hash-link" href="#what-approaches-are-there-for-handling-data-immutability-do-i-have-to-use-immer" title="Direct link to heading">​</a></h2><p>You do not need to use Immer with Redux. Plain JavaScript, if written correctly, is perfectly capable of providing immutability without having to use an immutable-focused library.</p><p>However, guaranteeing immutability with JavaScript is difficult, and it can be easy to mutate an object accidentally, causing bugs in your app that are extremely difficult to locate. For this reason, using an immutable update utility library such as Immer can significantly improve the reliability of your app, and make your app’s development much easier.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-15">Further Information<a class="hash-link" href="#further-information-15" title="Direct link to heading">​</a></h4><p><strong>Discussions</strong></p><ul><li><a href="https://github.com/reduxjs/redux/issues/1422" target="_blank" rel="noopener noreferrer">#1185: Question: Should I use immutable data structures?</a></li><li><a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">Introduction to Immer</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-are-the-issues-with-using-plain-javascript-for-immutable-operations">What are the issues with using plain JavaScript for immutable operations?<a class="hash-link" href="#what-are-the-issues-with-using-plain-javascript-for-immutable-operations" title="Direct link to heading">​</a></h2><p>JavaScript was never designed to provide guaranteed immutable operations. Accordingly, there are several issues you need to be aware of if you choose to use it for your immutable operations in your Redux app.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="accidental-object-mutation">Accidental Object Mutation<a class="hash-link" href="#accidental-object-mutation" title="Direct link to heading">​</a></h3><p>With JavaScript, you can accidentally mutate an object (such as the Redux state tree) quite easily without realizing it. For example, updating deeply nested properties, creating a new <em>reference</em> to an object instead of a new object, or performing a shallow copy rather than a deep copy, can all lead to inadvertent object mutations, and can trip up even the most experienced JavaScript coder.</p><p>To avoid these issues, ensure you follow the recommended <a href="/recipes/structuring-reducers/immutable-update-patterns">immutable update patterns for ES6</a>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="verbose-code">Verbose Code<a class="hash-link" href="#verbose-code" title="Direct link to heading">​</a></h3><p>Updating complex nested state trees can lead to verbose code that is tedious to write and difficult to debug.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="poor-performance">Poor Performance<a class="hash-link" href="#poor-performance" title="Direct link to heading">​</a></h3><p>Operating on JavaScript objects and arrays in an immutable way can be slow, particularly as your state tree grows larger.</p><p>Remember, to change an immutable object, you must mutate a <em>copy</em> of it, and copying large objects can be slow as every property must be copied.</p><p>In contrast, immutable libraries such as Immer can employ structural sharing, which effectively returns a new object that reuses much of the existing object being copied from.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="further-information-16">Further Information<a class="hash-link" href="#further-information-16" title="Direct link to heading">​</a></h4><p><strong>Documentation</strong></p><ul><li><a href="/recipes/structuring-reducers/immutable-update-patterns">Immutable Update Patterns for ES6</a></li></ul><p><strong>Articles</strong></p><ul><li><a href="https://www.slideshare.net/mohitthatte/a-deep-dive-into-clojures-data-structures-euroclojure-2015" target="_blank" rel="noopener noreferrer">A deep dive into Clojure’s data structures</a></li><li><a href="https://t4d.io/javascript-and-immutability/" target="_blank" rel="noopener noreferrer">JavaScript and Immutability</a></li><li><a href="https://wecodetheweb.com/2016/02/12/immutable-javascript-using-es6-and-beyond/" target="_blank" rel="noopener noreferrer">Immutable Javascript using ES6 and beyond</a></li><li><a href="https://reactkungfu.com/2015/08/pros-and-cons-of-using-immutability-with-react-js/" target="_blank" rel="noopener noreferrer">Pros and Cons of using immutability with React.js - React Kung Fu</a></li></ul></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/faq/actions"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Actions</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/faq/code-structure"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Code Structure</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#table-of-contents" class="table-of-contents__link toc-highlight">Table of Contents</a></li><li><a href="#what-are-the-benefits-of-immutability" class="table-of-contents__link toc-highlight">What are the benefits of immutability?</a></li><li><a href="#why-is-immutability-required-by-redux" class="table-of-contents__link toc-highlight">Why is immutability required by Redux?</a></li><li><a href="#why-does-reduxs-use-of-shallow-equality-checking-require-immutability" class="table-of-contents__link toc-highlight">Why does Redux’s use of shallow equality checking require immutability?</a><ul><li><a href="#how-do-shallow-and-deep-equality-checking-differ" class="table-of-contents__link toc-highlight">How do shallow and deep equality checking differ?</a></li><li><a href="#how-does-redux-use-shallow-equality-checking" class="table-of-contents__link toc-highlight">How does Redux use shallow equality checking?</a></li><li><a href="#how-does-react-redux-use-shallow-equality-checking" class="table-of-contents__link toc-highlight">How does React-Redux use shallow equality checking?</a></li><li><a href="#why-does-react-redux-shallowly-check-each-value-within-the-props-object-returned-from-mapstatetoprop" class="table-of-contents__link toc-highlight">Why does React-Redux shallowly check each value within the props object returned from <code>mapStateToProp</code>?</a></li><li><a href="#how-does-react-redux-use-shallow-equality-checking-to-determine-whether-a-component-needs-re-rendering" class="table-of-contents__link toc-highlight">How does React-Redux use shallow equality checking to determine whether a component needs re-rendering?</a></li><li><a href="#why-will-shallow-equality-checking-not-work-with-mutable-objects" class="table-of-contents__link toc-highlight">Why will shallow equality checking not work with mutable objects?</a></li><li><a href="#does-shallow-equality-checking-with-a-mutable-object-cause-problems-with-redux" class="table-of-contents__link toc-highlight">Does shallow equality checking with a mutable object cause problems with Redux?</a></li><li><a href="#why-does-a-reducer-mutating-the-state-prevent-react-redux-from-re-rendering-a-wrapped-component" class="table-of-contents__link toc-highlight">Why does a reducer mutating the state prevent React-Redux from re-rendering a wrapped component?</a></li><li><a href="#why-does-a-selector-mutating-and-returning-a-persistent-object-to-mapstatetoprops-prevent-react-redux-from-re-rendering-a-wrapped-component" class="table-of-contents__link toc-highlight">Why does a selector mutating and returning a persistent object to <code>mapStateToProps</code> prevent React-Redux from re-rendering a wrapped component?</a></li><li><a href="#how-does-immutability-enable-a-shallow-check-to-detect-object-mutations" class="table-of-contents__link toc-highlight">How does immutability enable a shallow check to detect object mutations?</a></li><li><a href="#how-can-immutability-in-your-reducers-cause-components-to-render-unnecessarily" class="table-of-contents__link toc-highlight">How can immutability in your reducers cause components to render unnecessarily?</a></li><li><a href="#how-can-immutability-in-mapstatetoprops-cause-components-to-render-unnecessarily" class="table-of-contents__link toc-highlight">How can immutability in <code>mapStateToProps</code> cause components to render unnecessarily?</a></li></ul></li><li><a href="#what-approaches-are-there-for-handling-data-immutability-do-i-have-to-use-immer" class="table-of-contents__link toc-highlight">What approaches are there for handling data immutability? Do I have to use Immer?</a></li><li><a href="#what-are-the-issues-with-using-plain-javascript-for-immutable-operations" class="table-of-contents__link toc-highlight">What are the issues with using plain JavaScript for immutable operations?</a><ul><li><a href="#accidental-object-mutation" class="table-of-contents__link toc-highlight">Accidental Object Mutation</a></li><li><a href="#verbose-code" class="table-of-contents__link toc-highlight">Verbose Code</a></li><li><a href="#poor-performance" class="table-of-contents__link toc-highlight">Poor Performance</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/essentials/part-1-overview-concepts">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">常见问题</a></li><li class="footer__item"><a class="footer__link-item" href="/api/api-reference">API 文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactiflux Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started#help-and-discussion">Feedback</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2015–2022 Dan Abramov and Cam Song.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.29e80f7a.js"></script>
<script src="/assets/js/main.7ecee670.js"></script>
</body>
</html>