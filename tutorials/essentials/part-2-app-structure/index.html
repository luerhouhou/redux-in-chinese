<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/essentials/part-2-app-structure">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-66122997-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M7SNC3FDW9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-M7SNC3FDW9",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Redux 中文官网" href="/opensearch.xml"><title data-rh="true">Redux 基础，第二节：应用的结构 | Redux 中文官网</title><meta data-rh="true" property="og:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" name="twitter:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" property="og:url" content="http://cn.redux.js.org/tutorials/essentials/part-2-app-structure"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Redux 基础，第二节：应用的结构 | Redux 中文官网"><meta data-rh="true" name="description" content="The official Redux Essentials tutorial: learn the structure of a typical React + Redux app"><meta data-rh="true" property="og:description" content="The official Redux Essentials tutorial: learn the structure of a typical React + Redux app"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="http://cn.redux.js.org/tutorials/essentials/part-2-app-structure"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/tutorials/essentials/part-2-app-structure" hreflang="en"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/tutorials/essentials/part-2-app-structure" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.f2db9367.css">
<link rel="preload" href="/assets/js/runtime~main.d4659145.js" as="script">
<link rel="preload" href="/assets/js/main.770d8f43.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Redux 中文官网</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction/getting-started">入门</a><a class="navbar__item navbar__link" href="/tutorials/essentials/part-1-overview-concepts">教程</a><a class="navbar__item navbar__link" href="/api/api-reference">API</a><a class="navbar__item navbar__link" href="/faq">常见问题</a><a class="navbar__item navbar__link" href="/style-guide/style-guide">最佳实践</a><a href="https://www.github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">源码<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/nefe/redux-in-chinese/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">纠错</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/getting-started">简介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/tutorials/index">教程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/index">教程目录</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/quick-start">快速开始</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/typescript-quick-start">TypeScript 快速开始</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/tutorials/essentials/part-1-overview-concepts">Redux 循序渐进</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-1-overview-concepts">基础概念</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tutorials/essentials/part-2-app-structure">应用结构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-3-data-flow">数据流基础</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-4-using-data">使用数据</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-5-async-logic">异步逻辑与数据请求</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-6-performance-normalization">性能与数据范式化</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-7-rtk-query-basics">RTK Query Basics</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/essentials/part-8-rtk-query-advanced">RTK Query Advanced Patterns</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/tutorials/fundamentals/part-1-overview">Redux 深入浅出</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/videos">Videos</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/usage/">使用指南</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/understanding/thinking-in-redux/motivation">深入理解 Redux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/style-guide/">编码规范</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/api/api-reference">API 文档</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redux-toolkit/overview">Redux Toolkit</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">教程</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Redux 循序渐进</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">应用结构</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>第二节：应用的结构</h1><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>你将学到</h5></div><div class="admonition-content"><ul><li>一个典型的 React + Redux 应用程序的结构</li><li>如何在 Redux DevTools Extension 中查看状态变化</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a class="hash-link" href="#简介" title="Direct link to heading">​</a></h2><p>在 <a href="/tutorials/essentials/part-1-overview-concepts">第一节：Redux 概述和概念</a> 中，我们研究了 Redux 为何有用、用于描述 Redux 代码不同部分的术语和概念，以及数据如何在 Redux 应用程序中流动。</p><p>现在，让我们看一个真实的工作示例，看看这些部分是如何组合在一起的。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="计数器示例应用程序">计数器示例应用程序<a class="hash-link" href="#计数器示例应用程序" title="Direct link to heading">​</a></h2><p>我们将看到的示例项目是一个小型计数器应用程序，它允许我们在单击按钮时对数字进行加减运算。它可能不是很令人兴奋，但它展示了一个 React + Redux 应用程序的所有重要部分。</p><p>本项目使用 <a href="https://github.com/reduxjs/cra-template-redux" target="_blank" rel="noopener noreferrer">Create-React-App 的官方 Redux 模板</a> 创建。开箱即用，它已经配置了标准的 Redux 应用程序结构，使用 <a href="https://redux-toolkit.js.org" target="_blank" rel="noopener noreferrer">Redux Toolkit</a> 创建 Redux 存储和逻辑，以及 <a href="https://react-redux.js.org" target="_blank" rel="noopener noreferrer">React-Redux</a> 将 Redux 存储和 React 组件连接在一起。</p><p>这是该项目的实时版本。 您可以通过单击右侧应用程序预览中的按钮来试用它，并浏览左侧的源文件。</p><iframe class="codesandbox" src="https://codesandbox.io/embed/github/reduxjs/redux-essentials-counter-example/tree/master/?fontsize=14&amp;hidenavigation=1&amp;module=%2Fsrc%2Ffeatures%2Fcounter%2FcounterSlice.js&amp;theme=dark&amp;runonclick=1" title="redux-essentials-example" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><p>如果你想尝试在自己的电脑上创建这个项目，你可以<!-- -->[开始一个新的 Create-React-App 项目]<!-- -->(<a href="https://create-react-app.dev/docs/getting-started#selecting-a" target="_blank" rel="noopener noreferrer">https://create-react-app.dev/docs/getting-started#selecting-a</a> -template) 使用我们的 Redux 模板：</p><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">npx create-react-app redux-essentials-example --template redux</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="使用计数器应用程序">使用计数器应用程序<a class="hash-link" href="#使用计数器应用程序" title="Direct link to heading">​</a></h3><p>计数器应用程序已经设置好，让我们可以在使用时观察内部发生的情况。</p><p>打开浏览器的 DevTools。 然后，在 DevTools 中选择“Redux”选项卡，然后单击右上角工具栏中的“State”按钮。 您应该会看到如下所示的内容：</p><p><img loading="lazy" alt="Redux DevTools: initial app state" src="/assets/images/devtools-initial-3b52cedcebd74c327ee3b9b2342d69db.png" width="1398" height="686" class="img_ev3q"></p><p>在右侧，我们可以看到我们的 Redux Store 的初始 state 是这样：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">counter</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">value</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>DevTools 将向我们展示 Store 中的 state 是如何变化的。</p><p>让我们先玩一下这个应用程序，看看它有什么作用。单击应用程序中的“+”按钮，然后查看 Redux DevTools 中的“Diff”选项卡：</p><p><img loading="lazy" alt="Redux DevTools: first dispatched action" src="/assets/images/devtools-first-action-c9d4378ec1ec3e1c8f93b1e8e4a1d033.png" width="1398" height="688" class="img_ev3q"></p><p>我们可以在这里看到两个重要的事情：</p><ul><li>当我们点击“+”按钮时，一个 type 为“counter/increment”的 action 被 dispatch 到 store</li><li>dispatch action 后，<code>state.counter.value</code> 字段开始从 <code>0</code> 改到 <code>1</code></li></ul><p>现在尝试以下步骤：</p><ul><li>再次单击“+”按钮。显示的值现在应该是 2。</li><li>单击“-”按钮一次。显示的值现在应该是 1。</li><li>单击“添加金额”按钮。显示的值现在应该是 3。</li><li>将文本框中的数字“2”更改为“3”</li><li>单击“添加异步”按钮。您应该会看到一个进度条填充按钮，几秒钟后，显示的值应更改为 6。</li></ul><p>回到 Redux DevTools。您应该会看到总共 dispatch 了五个 action，每单击一个按钮触发一次。现在从左侧列表中选择最后一个 <code>&quot;counter/incrementByAmount&quot;</code> 条目，然后单击右侧的 &quot;Action&quot; 选项卡：</p><p><img loading="lazy" alt="Redux DevTools: done clicking buttons" src="/assets/images/devtools-done-clicking-8826e622b87734ea2a0044233a2a642f.png" width="1398" height="533" class="img_ev3q"></p><p>我们可以看到这个 action 对象是这样的：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;counter/incrementByAmount&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果您单击“差异”选项卡，您可以看到 <code>state.counter.value</code> 字段响应该 action 从 <code>3</code> 更改为 <code>6</code>。</p><p>查看我们的应用程序内部发生的事情以及我们的状态如何随时间变化的能力非常强大！</p><p>DevTools 有更多命令和选项可帮助您调试应用程序。尝试单击右上角的“跟踪 Trace”选项卡。 您应该在面板中看到一个 JavaScript 函数堆栈跟踪，其中有几段源代码显示了当 action 到达 store 时正在执行的行。特别应该突出显示一行：我们从 <code>&lt;Counter&gt;</code> 组件 dispatch 此 action 的代码行：</p><p><img loading="lazy" alt="Redux DevTools: action stack traces" src="/assets/images/devtools-action-stacktrace-8ee180838c97840a749b9209e80c8a72.png" width="1400" height="694" class="img_ev3q"></p><p>这使得跟踪代码的哪一部分 dispatch 了特定 action 变得更加容易。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="application-实现">Application 实现<a class="hash-link" href="#application-实现" title="Direct link to heading">​</a></h2><p>你已经知道了应用的功能，现在看一下代码实现。</p><p>以下是构成此应用程序的关键文件：</p><ul><li><code>/src</code><ul><li><code>index.js</code>: the starting point for the app</li><li><code>App.js</code>: the top-level React component</li><li><code>/app</code><ul><li><code>store.js</code>: creates the Redux store instance</li></ul></li><li><code>/features</code><ul><li><code>/counter</code><ul><li><code>Counter.js</code>: a React component that shows the UI for the counter feature</li><li><code>counterSlice.js</code>: the Redux logic for the counter feature</li></ul></li></ul></li></ul></li></ul><p>让我们先看看 Redux store 是如何创建的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建-redux-store">创建 Redux Store<a class="hash-link" href="#创建-redux-store" title="Direct link to heading">​</a></h3><p>打开 <code>app/store.js</code>，代码是这样：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">app/store.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> configureStore </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">counterReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../features/counter/counterSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">configureStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">reducer</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">counter</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> counterReducer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Redux store 是使用 Redux Toolkit 中的 <code>configureStore</code> 函数创建的。<code>configureStore</code> 要求我们传入一个 <code>reducer</code> 参数。</p><p>我们的应用程序可能由许多不同的特性组成，每个特性都可能有自己的 reducer 函数。当我们调用<code>configureStore</code> 时，我们可以传入一个对象中的所有不同的 reducer。 对象中的键名 key 将定义最终状态树中的键名 key。</p><p>我们有一个名为 <code>features/counter/counterSlice.js</code> 的文件，它为计数器逻辑导出了一个 reducer 函数。 我们可以在此处导入 <code>counterReducer</code> 函数，并在创建 store 时包含它。</p><p>当我们传入一个像 <code>{counter: counterReducer}</code> 这样的对象时，它表示我们希望在 Redux 状态对象中有一个 <code>state.counter</code> 部分，并且我们希望 <code>counterReducer</code> 函数负责决定是否以及如何在 dispatch action 时更新 <code>state.counter</code> 部分。</p><p>Redux 允许使用不同类型的插件（“中间件”和“增强器”）自定义 store 设置。<code>configureStore</code> 默认会自动在 store setup 中添加几个中间件以提供良好的开发者体验，并且还设置 store 以便 Redux DevTools Extension 可以检查其内容。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="redux-切片slice">Redux 切片（Slice）<a class="hash-link" href="#redux-切片slice" title="Direct link to heading">​</a></h4><p><strong>“切片”是应用中单个功能的 Redux reducer 逻辑和 action 的集合</strong>, 通常一起定义在一个文件中。该名称来自于将根 Redux 状态对象拆分为多个状态“切片”。</p><p>比如，在一个博客应用中，store 的配置大致长这样：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> configureStore </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">usersReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../features/users/usersSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">postsReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../features/posts/postsSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">commentsReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../features/comments/commentsSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">configureStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">reducer</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">users</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> usersReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">posts</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> postsReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">comments</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> commentsReducer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>例子中，<code>state.users</code>，<code>state.posts</code>，和 <code>state.comments</code> 均是 Redux state 的一个切片“slice”。由于 <code>usersReducer</code> 负责更新 <code>state.users</code> 切片，我们将其称为“slice reducer”函数。</p><details class="detailed-explanation"><summary><h4>细节说明：Reducer 与 State 的结构</h4></summary><p>Redux store 需要在创建时传入一个“root reducer”函数。因此，如果我们有许多不同的 slice reducer 函数，我们如何获得单个 root reducer，以及它如何定义 Redux store 中 state 的内容呢？</p><p>如果我们尝试手动调用所有 slice 的 reducer，它可能如下所示：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">rootReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> </span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">users</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">usersReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">users</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">posts</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">postsReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">posts</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">comments</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">commentsReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">comments</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>这会单独调用每个 slice reducer，传入 Redux 状态的特定切片，并将每个返回值包含在最终的新 Redux 状态对象中。</p><p>Redux 有一个名为 <a href="/api/combinereducers"><code>combineReducers</code></a> 的函数，它会自动为我们执行此操作。它接受一个全是 slice reducer 的对象作为其参数，并返回一个函数，该函数在调度操作时调用每个 slice reducer。每个 slice reducer 的结果都组合成一个对象作为最终结果。我们可以使用 <code>combineReducers</code> 做和前面例子一样的事情：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> rootReducer </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">combineReducers</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">users</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> usersReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">posts</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> postsReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">comments</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> commentsReducer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>当我们将 slice reducer 的对象传递给 <code>configureStore</code> 时，它会将这些对象传递给 <code>combineReducers</code> 以便我们生成根 reducer。</p><p>正如我们之前看到的，你也可以直接传递一个 reducer 函数作为 <code>reducer</code> 参数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> store </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">configureStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">reducer</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> rootReducer</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></details><h3 class="anchor anchorWithStickyNavbar_LWe7" id="创建-slice-reducer-和-action">创建 Slice Reducer 和 Action<a class="hash-link" href="#创建-slice-reducer-和-action" title="Direct link to heading">​</a></h3><p>既然我们知道<code>counterReducer</code> 函数来自 <code>features/counter/counterSlice.js</code>，那么让我们一块一块地看看那个文件里有什么。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/counterSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> createSlice </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;@reduxjs/toolkit&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> counterSlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">name</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;counter&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">initialState</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">value</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">reducers</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">increment</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Redux Toolkit allows us to write &quot;mutating&quot; logic in reducers. It</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// doesn&#x27;t actually mutate the state because it uses the immer library,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// which detects changes to a &quot;draft state&quot; and produces a brand new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// immutable state based off those changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">+=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">decrement</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">-=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">incrementByAmount</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">+=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> increment</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> decrement</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> incrementByAmount </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> counterSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> counterSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">reducer</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>早些时候，我们看到单击 UI 中的不同按钮会 dispatch 三种不同类型的 Redux action：</p><ul><li><code>{type: &quot;counter/increment&quot;}</code></li><li><code>{type: &quot;counter/decrement&quot;}</code></li><li><code>{type: &quot;counter/incrementByAmount&quot;}</code></li></ul><p>我们知道 action 是带有 <code>type</code> 字段的普通对象，<code>type</code> 字段总是一个字符串，并且我们通常有 action creator 函数来创建和返回 action 对象。那么在哪里定义 action 对象、类型字符串和 action creator 呢？</p><p>我们<em>可以</em>每次都手写。但是，那会很乏味。此外，Redux 中<em>真正</em>重要的是 reducer 函数，以及其中计算新状态的逻辑。</p><p>Redux Toolkit 有一个名为 <code>createSlice</code> 的函数，它负责生成 action 类型字符串、action creator 函数和 action 对象的工作。您所要做的就是为这个切片定义一个名称，编写一个包含 reducer 函数的对象，它会自动生成相应的 action 代码。<code>name</code> 选项的字符串用作每个 action 类型的第一部分，每个 reducer 函数的键名用作第二部分。因此，<code>&quot;counter&quot;</code> 名称 + <code>&quot;increment&quot;</code> reducer 函数生成了一个 action 类型 <code>{type: &quot;counter/increment&quot;}</code>。（毕竟，如果计算机可以为我们做，为什么要手写！）</p><p>除了 <code>name</code> 字段，<code>createSlice</code> 还需要我们为 reducer 传入初始状态值，以便在第一次调用时就有一个 <code>state</code>。在这种情况下，我们提供了一个对象，它有一个从 0 开始的 <code>value</code> 字段。</p><p>我们可以看到这里有三个 reducer 函数，它们对应于通过单击不同按钮 dispatch 的三种不同的 action 类型。</p><p><code>createSlice</code> 会自动生成与我们编写的 reducer 函数同名的 action creator。我们可以通过调用其中一个来检查它并查看它返回的内容：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">counterSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">increment</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// {type: &quot;counter/increment&quot;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它还生成知道如何响应所有这些 action 类型的 slice reducer 函数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> newState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> counterSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">reducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">value</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">10</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  counterSlice</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">actions</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">increment</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">newState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// {value: 11}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reducer-的规则">Reducer 的规则<a class="hash-link" href="#reducer-的规则" title="Direct link to heading">​</a></h3><p>上一节讲过，Reducer 必需符合以下规则：</p><ul><li>仅使用 <code>state</code> 和 <code>action</code> 参数计算新的状态值</li><li>禁止直接修改 <code>state</code>。必须通过复制现有的 <code>state</code> 并对复制的值进行更改的方式来做 <em>不可变更新（immutable updates）</em>。</li><li>禁止任何异步逻辑、依赖随机值或导致其他“副作用”的代码</li></ul><p>但为什么这些规则很重要？有几个不同的原因：</p><ul><li>Redux 的目标之一是使您的代码可预测。当函数的输出仅根据输入参数计算时，更容易理解该代码的工作原理并对其进行测试。</li><li>另一方面，如果一个函数依赖于自身之外的变量，或者行为随机，你永远不知道运行它时会发生什么。</li><li>如果一个函数 mutate 了其他对象，比如它的参数，这可能会意外地改变应用程序的工作方式。这可能是错误的常见来源，例如“我更新了我的状态，但现在我的 UI 没有在应该更新的时候更新！”</li><li>Redux DevTools 的一些功能取决于你的 reducer 是否正确遵循这些规则</li></ul><p>“不可变更新（Immutable Updates）” 这个规则尤其重要，值得进一步讨论。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="reducer-与-不可变更新">Reducer 与 不可变更新<a class="hash-link" href="#reducer-与-不可变更新" title="Direct link to heading">​</a></h3><p>前面讲过 “可变更新 mutation”（更新已有对象/数组的值）与“不可变更新 immutability”（认为值是不可以改变的）</p><p>在 Redux 中，<strong><em>永远</em> 不允许在 reducer 中更改 state 的原始对象！</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// ❌ 非法 - 默认情况下，这将更改 state！</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">123</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>:::</p><p>不能在 Redux 中更改 state 有几个原因：</p><ul><li>它会导致 bug，例如 UI 未正确更新以显示最新值</li><li>更难理解状态更新的原因和方式</li><li>编写测试变得更加困难</li><li>它打破了正确使用“时间旅行调试”的能力</li><li>它违背了 Redux 的预期精神和使用模式</li></ul><p>所以如果我们不能更改原件，我们如何返回更新的状态呢？</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p><strong>Reducer 中必需要先创建原始值的<em>副本</em>，然后可以改变副本。</strong></p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// ✅ 这样操作是安全的，因为创建了副本</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">value</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">123</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>我们已经看到我们可以<a href="/tutorials/essentials/part-1-overview-concepts#immutability">手动编写不可变更新</a>，通过使用 JavaScript 的数组/对象扩展运算符和其他返回原始值副本的函数。但是，如果您认为“以这种方式手动编写不可变更新看起来很难记住和正确执行”……是的，您是对的！:)</p><p>手动编写不可变的更新逻辑确实繁琐，而且在 reducer 中意外改变状态是 Redux 用户最常犯的一个错误。</p><p><strong>这就是为什么 Redux Toolkit 的 <code>createSlice</code> 函数可以让您以更简单的方式编写不可变更新！</strong></p><p><code>createSlice</code> 内部使用了一个名为 <a href="https://immerjs.github.io/immer/" target="_blank" rel="noopener noreferrer">Immer</a> 的库。 Immer 使用一种称为 “Proxy” 的特殊 JS 工具来包装您提供的数据，当你尝试 ”mutate“ 这些数据的时候，奇迹发生了，<strong>Immer 会跟踪您尝试进行的所有更改，然后使用该更改列表返回一个安全的、不可变的更新值</strong>，就好像您手动编写了所有不可变的更新逻辑一样。</p><p>所以，下面的代码：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">handwrittenReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">first</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token literal-property property" style="color:#F92672">second</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">          </span><span class="token literal-property property" style="color:#F92672">fourth</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">someValue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">        </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>可以变成这样：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">reducerWithImmer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">first</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">second</span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">someId</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">fourth</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">someValue</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>变得非常易读！</p><p>但，还有一些非常重要的规则要记住：</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>警告</h5></div><div class="admonition-content"><p><strong>你<em>只能</em>在 Redux Toolkit 的 <code>createSlice</code> 和 <code>createReducer</code> 中编写 “mutation” 逻辑，因为它们在内部使用 Immer！如果你在没有 Immer 的 reducer 中编写 mutation 逻辑，它<em>将</em>改变状态并导致错误！</strong></p></div></div><p>考虑到这一点，让我们回过头来看看计数器 slice 中的实际的 reducer。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/counterSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> counterSlice </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createSlice</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">name</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;counter&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">initialState</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token literal-property property" style="color:#F92672">value</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token literal-property property" style="color:#F92672">reducers</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">increment</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Redux Toolkit allows us to write &quot;mutating&quot; logic in reducers. It</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// doesn&#x27;t actually mutate the state because it uses the immer library,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// which detects changes to a &quot;draft state&quot; and produces a brand new</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// immutable state based off those changes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">+=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">decrement</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">-=</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function-variable function" style="color:#E6D874">incrementByAmount</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">+=</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以看到 <code>increment</code> reducer 总是给 <code>state.value</code> 加 1。 因为 Immer 知道我们已经对原来的 <code>state</code> 对象进行了更改，所以我们实际上不必在此处返回任何内容。 同理，<code>decrement</code> reducer 减 1。</p><p>在这两个 reducer 中，我们实际上不需要让我们的代码查看 <code>action</code> 对象。它无论如何都会被传入，但由于我们不需要它，我们可以省掉把 <code>action</code> 声明为 reducer 的参数。</p><p>另一方面，<code>incrementByAmount</code> 这个 reducer 还需要知道更多信息：它应该增加多少计数器值。因此，我们将 reducer 声明为同时具有 <code>state</code> 和 <code>action</code> 参数。这样，我们知道我们在文本框中输入的金额被放入 <code>action.payload</code> 字段，这就是要被添加到 <code>state.value</code> 的值。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>想了解更多？</h5></div><div class="admonition-content"><p>关于不变性和编写不可变更新的更多信息，请参阅 <a href="/recipes/structuring-reducers/ImmutableUpdatePatterns.md">“不可变更新模式”文档页面</a> 和 <a href="https://daveceddia.com/react-redux-immutability-guide/" target="_blank" rel="noopener noreferrer">The Complete Guide to Immutability in React and Redux</a>。</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="用-thunk-编写异步逻辑">用 Thunk 编写异步逻辑<a class="hash-link" href="#用-thunk-编写异步逻辑" title="Direct link to heading">​</a></h3><p>到目前为止，我们应用程序中的所有逻辑都是同步的。首先 dispatch action，store 调用 reducer 来计算新状态，然后 dispatch 函数完成并结束。但是，JavaScript 语言有很多编写异步代码的方法，我们的应用程序通常具有异步逻辑，比如从 API 请求数据之类的事情。我们需要一个地方在我们的 Redux 应用程序中放置异步逻辑。</p><p><strong>thunk</strong> 是一种特定类型的 Redux 函数，可以包含异步逻辑。Thunk 是使用两个函数编写的：</p><ul><li>一个内部 thunk 函数，它以 <code>dispatch</code> 和 <code>getState</code> 作为参数</li><li>外部创建者函数，它创建并返回 thunk 函数</li></ul><p>从 <code>counterSlice</code> 导出的函数就是一个 thunk action creator 的例子。</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/counterSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// The function below is called a thunk and allows us to perform async logic.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// It can be dispatched like a regular action: `dispatch(incrementAsync(10))`.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// This will call the thunk with the `dispatch` function as the first argument.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Async code can then be executed and other actions can be dispatched</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">incrementAsync</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">amount</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">dispatch</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">setTimeout</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">incrementByAmount</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">amount</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1000</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们可以像使用普通 Redux action creator 一样使用它们：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">incrementAsync</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token number" style="color:#AE81FF">5</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是，使用 thunk 需要在创建时将 <code>redux-thunk</code> <em>middleware</em>（一种 Redux 插件）添加到 Redux store 中。幸运的是，Redux Toolkit 的 <code>configureStore</code> 函数已经自动为我们配置好了，所以我们可以继续在这里使用 thunk。</p><p>当您需要进行 AJAX 调用以从服务器获取数据时，您可以将该调用放入 thunk 中。这是一个写得有点长的例子，所以你可以看到它是如何定义的：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/counterSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// 外部的 thunk creator 函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">fetchUserById</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">userId</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// 内部的 thunk 函数</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">try</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// thunk 内发起异步数据请求</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> user </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> userAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">fetchById</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">userId</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// 但数据响应完成后 dispatch 一个 action</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">userLoaded</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">user</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">catch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// 如果过程出错，在这里处理</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 <a href="/tutorials/essentials/part-5-async-logic">第五节：异步逻辑和数据请求</a> 中也使用到了 thunk。</p><details class="detailed-explanation"><summary><h4>细节说明：Thunk 和异步逻辑</h4></summary><p>我们知道我们不允许在 reducer 中放置任何类型的异步逻辑。但是，这种逻辑必须存在于某个地方。</p><p>如果我们可以访问 Redux 的 store，我们可以编写一些异步代码并在完成后调用 <code>store.dispatch()</code>：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> store </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">configureStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">reducer</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> counterReducer </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token function" style="color:#E6D874">setTimeout</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">increment</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">250</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>但是，在真正的 Redux 应用程序中，我们不允许将 store 导入到其他文件中，尤其是在我们的 React 组件中，因为它使代码更难以测试和重用。</p><p>另外，我们经常需要编写一些我们知道最终会与<em>一些</em> store 一起使用的异步逻辑，但我们不知道<em>是哪块</em> store。</p><p>Redux 的 store 可以使用“中间件”进行扩展，中间件是一种可以添加额外功能的附加组件或插件。使用中间件的最常见原因是让您编写具有异步逻辑的代码，但同时仍能与 store 对话。他们还可以修改 store，以便我们可以调用 <code>dispatch()</code> 并传入普通 action 对象<em>以外</em>的值，例如函数或 Promise。</p><p>Redux Thunk 中间件修改了 store 以让您将函数传递给 <code>dispatch</code>。事实上，代码很短，只有下面几行：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">thunkMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter punctuation" style="color:#F8F8F2">{</span><span class="token parameter"> dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState </span><span class="token parameter punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">typeof</span><span class="token plain"> action </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;function&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">action</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">dispatch</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>它先判断传入 <code>dispatch</code> 的 action 是函数还是对象。如果是一个函数，则调用函数，并返回结果。否则，传入的是普通 action 对象，就把这个 action 传递给 store 处理。</p><p>这就让我们可以用一种方法来处理同步或者异步方法，同时仍然可以调用 <code>dispatch</code> 和 <code>getState</code>。</p></details><p>此文件中还有一个函数，我们稍后会在查看 <code>&lt;Counter&gt;</code> UI 组件时讨论它。</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>想了解更多？</h5></div><div class="admonition-content"><p>查看 <a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener noreferrer">the Redux Thunk docs</a>, the post <a href="https://daveceddia.com/what-is-a-thunk/" target="_blank" rel="noopener noreferrer">What the heck is a thunk?</a> and the <a href="/faq/actions#how-can-i-represent-side-effects-such-as-ajax-calls-why-do-we-need-things-like-action-creators-thunks-and-middleware-to-do-async-behavior">Redux FAQ entry on &quot;why do we use middleware for async?&quot;</a> for more information.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="react-counter-组件">React Counter 组件<a class="hash-link" href="#react-counter-组件" title="Direct link to heading">​</a></h3><p>前面，我们看到了一个独立的 React <code>&lt;Counter&gt;</code> 组件是什么样的。我们的 React+Redux 应用程序有一个类似的 <code>&lt;Counter&gt;</code> 组件，但它做了一些不同的事情。</p><p>我们将首先查看 <code>Counter.js</code> 组件文件：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/Counter.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useSelector</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> useDispatch </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports">  decrement</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports">  increment</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports">  incrementByAmount</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports">  incrementAsync</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports">  selectCount</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token imports"></span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./counterSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">styles</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./Counter.module.css&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#E6D874">Counter</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> count </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useDispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">incrementAmount</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIncrementAmount</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;2&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">div</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">div</span><span class="token tag" style="color:#F92672"> </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">row</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">button</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">button</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">aria-label</span><span class="token tag attr-value punctuation attr-equals" style="color:#F8F8F2">=</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag attr-value" style="color:#E6D874">Increment value</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">dispatch</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript function" style="color:#E6D874">increment</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">        </span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain-text">          +</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">button</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">span</span><span class="token tag" style="color:#F92672"> </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">value</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">count</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">span</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">button</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">button</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">aria-label</span><span class="token tag attr-value punctuation attr-equals" style="color:#F8F8F2">=</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag attr-value" style="color:#E6D874">Decrement value</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">          </span><span class="token tag attr-name" style="color:#a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">dispatch</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript function" style="color:#E6D874">decrement</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">        </span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">          -</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">        </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">button</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">      </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">div</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">      </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token comment" style="color:#c6cad2">/* 这里省略了额外的 render 代码 */</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">div</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>与之前的简单 React 示例一样，我们有一个名为 <code>Counter</code> 的函数组件，它将一些数据存储在 <code>useState</code> hooks 中。</p><p>然而，在我们的组件中，看起来我们并没有将当前计数器的值存储为 state。而是放到 <code>count</code> 变量中，但它不是来自 <code>useState</code> hooks。</p><p>虽然 React 包含几个内置 hooks，如 <code>useState</code> 和 <code>useEffect</code>，其他库可以创建自己的 <a href="https://reactjs.org/docs/hooks-custom.html" target="_blank" rel="noopener noreferrer">自定义 hooks</a>，使用 React 的 hooks 来构建自定义逻辑。</p><p><a href="https://react-redux.js.org/" target="_blank" rel="noopener noreferrer">React-Redux 库</a> 有 <!-- -->[一组自定义 hooks，允许你的 React 组件与 Redux store 交互]<!-- -->(<a href="https://react-redux.js" target="_blank" rel="noopener noreferrer">https://react-redux.js</a> .org/api/hooks）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用-useselector-提取数据">使用 <code>useSelector</code> 提取数据<a class="hash-link" href="#使用-useselector-提取数据" title="Direct link to heading">​</a></h4><p>首先，<code>useSelector</code> 这个 hooks 让我们的组件从 Redux 的 store 状态树中提取它需要的任何数据。</p><p>前面讲过，我们可以编写 “selector” 函数，它以 <code>state</code> 作为参数并返回状态树的一部分。</p><p><code>counterSlice.js</code> 在底部有这个 selector 函数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/counterSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// The function below is called a selector and allows us to select a value from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// the state. Selectors can also be defined inline where they&#x27;re used instead of</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// in the slice file. For example: `useSelector((state) =&gt; state.counter.value)`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">selectCount</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">counter</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>如果我们可以访问 Redux 的 store，我们可以将当前计数器值检索为：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> count </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">selectCount</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">getState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">count</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// 0</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们的组件不能直接与 Redux store 对话，因为组件文件中不能引入 store。但是，<code>useSelector</code> 负责为我们在幕后与 Redux store 对话。 如果我们传入一个 selector 函数，它会为我们调用 <code>someSelector(store.getState())</code>，并返回结果。</p><p>因此，我们可以通过执行以下操作来获取 store 中的计数器值：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> count </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">selectCount</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们也不是<em>只能</em>使用已经导出的 selector。例如，我们可以编写一个选择器函数作为 <code>useSelector</code> 的内联参数：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> countPlusTwo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useSelector</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> state</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">counter</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">+</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">2</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>每当一个 action 被 dispatch 并且 Redux store 被更新时，<code>useSelector</code> 将重新运行我们的选择器函数。如果选择器返回的值与上次不同，<code>useSelector</code> 将确保我们的组件使用新值重新渲染。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="使用-usedispatch-来-dispatch-action">使用 <code>useDispatch</code> 来 dispatch action<a class="hash-link" href="#使用-usedispatch-来-dispatch-action" title="Direct link to heading">​</a></h4><p>类似地，我们知道如果我们可以访问 Redux store，我们可以使用 action creator 来 dispatch action，比如 <code>store.dispatch(increment())</code>。 由于我们无法访问 store 本身，因此我们需要某种方式来访问 <code>dispatch</code> 方法。</p><p><code>useDispatch</code> hooks 为我们完成了这项工作，并从 Redux store 中为我们提供了实际的 <code>dispatch</code> 方法：</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useDispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>从那里，我们可以在用户执行诸如单击按钮之类的操作时 dispatch 对应 action：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/Counter.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">button</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">  </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">button</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">  </span><span class="token tag attr-name" style="color:#a6e22e">aria-label</span><span class="token tag attr-value punctuation attr-equals" style="color:#F8F8F2">=</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag attr-value" style="color:#E6D874">Increment value</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">  </span><span class="token tag attr-name" style="color:#a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">dispatch</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript function" style="color:#E6D874">increment</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672"></span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">  +</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text"></span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">button</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="组件-state-与-表单">组件 State 与 表单<a class="hash-link" href="#组件-state-与-表单" title="Direct link to heading">​</a></h3><p>现在你可能想知道，“我是否总是需要将我所有应用程序的状态放入 Redux store？”</p><p>答案是 <strong>不。整个应用程序所需的全局状态应该放在 Redux store 中。而只在一个地方用到的状态应该放到组件的 state。</strong></p><p>在这个例子中，我们有一个文本输入框 input，用户可以在其中输入要添加到计数器的下一个数字：</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">features/counter/Counter.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">incrementAmount</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setIncrementAmount</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;2&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// later</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">div</span><span class="token tag" style="color:#F92672"> </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">row</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">input</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">textbox</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">aria-label</span><span class="token tag attr-value punctuation attr-equals" style="color:#F8F8F2">=</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag attr-value" style="color:#E6D874">Set increment amount</span><span class="token tag attr-value punctuation" style="color:#F8F8F2">&quot;</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">value</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">incrementAmount</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">onChange</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript parameter" style="color:#F92672">e</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">setIncrementAmount</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript" style="color:#F92672">e</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">target</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">value</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">    </span><span class="token tag punctuation" style="color:#F8F8F2">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">button</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">button</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">dispatch</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript function" style="color:#E6D874">incrementByAmount</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript known-class-name class-name" style="color:#F92672">Number</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript" style="color:#F92672">incrementAmount</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript operator" style="color:#F8F8F2">||</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript number" style="color:#AE81FF">0</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">    </span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">      Add Amount</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">button</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag" style="color:#F92672">button</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">className</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">styles</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">.</span><span class="token tag script language-javascript property-access" style="color:#F92672">asyncButton</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">      </span><span class="token tag attr-name" style="color:#a6e22e">onClick</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript function" style="color:#E6D874">dispatch</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript function" style="color:#E6D874">incrementAsync</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript known-class-name class-name" style="color:#F92672">Number</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">(</span><span class="token tag script language-javascript" style="color:#F92672">incrementAmount</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript operator" style="color:#F8F8F2">||</span><span class="token tag script language-javascript" style="color:#F92672"> </span><span class="token tag script language-javascript number" style="color:#AE81FF">0</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">)</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag" style="color:#F92672"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token tag" style="color:#F92672">    </span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">      Add Async</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">button</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag" style="color:#F92672">div</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们<em>可以</em>在 Redux store 中保留当前数字字符串，方法是在输入的 <code>onChange</code> 处理程序中 dispatch action 并将其保存在我们的 reducer 中。但是，这并没有给我们带来任何好处。唯一使用文本字符串的地方是这里，在 <code>&lt;Counter&gt;</code> 组件中。（当然，在这个例子中只有一个其他组件：<code>&lt;App&gt;</code>。但即使我们有一个包含许多组件的更大的应用程序，也只有 <code>&lt;Counter&gt;</code> 关心这个输入值。）</p><p>因此，将该值保留在 <code>&lt;Counter&gt;</code> 组件中的 <code>useState</code> 的 hooks 中是有意义的。</p><p>类似地，如果我们有一个名为 <code>isDropdownOpen</code> 的布尔值，应用程序中的其他组件不会关心它——它应该真正保持在这个组件的本地。</p><p><strong>在 React + Redux 应用中，你的全局状态应该放在 Redux store 中，你的本地状态应该保留在 React 组件中。</strong></p><p>如果您不确定该放在哪里，这里有一些常用的经验法则，用于确定应该将哪种数据放入 Redux：</p><ul><li>应用程序的其他部分是否关心这些数据？</li><li>您是否需要能够基于这些原始数据创建进一步的派生数据？</li><li>是否使用相同的数据来驱动多个组件？</li><li>能够将这种状态恢复到给定的时间点（即时间旅行调试）对您是否有价值？</li><li>是否要缓存数据（即，如果数据已经存在，则使用它的状态而不是重新请求它）？</li><li>您是否希望在热重载 UI 组件（交换时可能会丢失其内部状态）时保持此数据一致？</li></ul><p>这也是一般如何在 Redux 中考虑表单的一个很好的例子。 <strong>大多数表单的 state 不应该保存在 Redux 中。</strong> 相反，在编辑表单的时候把数据存到表单组件中，当用户提交表单的时候再 dispatch action 来更新 store。</p><p>在我们继续之前要注意的另一件事是：还记得 <code>counterSlice.js</code> 中的 <code>incrementAsync</code> 这个 thunk 吗？我们在这个组件中使用它。请注意，我们使用它的方式与 dispatch 其他普通的 action 是一样的。这个组件不关心我们是在 dispatch 一个普通的 action 还是异步逻辑。它只知道当你点击那个按钮时，它会执行 dispatch。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="providing-the-store">Providing the Store<a class="hash-link" href="#providing-the-store" title="Direct link to heading">​</a></h3><p>我们已经看到我们的组件可以使用 <code>useSelector</code> 和 <code>useDispatch</code> 这两个 hooks 与 Redux 的 store 通信。奇怪的是，我们并没有导入 store，那么这些 hooks 怎么知道要与哪个 Redux store 对话呢？</p><p>现在我们已经看到了这个应用程序的全貌，是时候回到这个应用程序的起点，看看拼图的最后部分是如何组合在一起的。</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">index.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-dom&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./index.css&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./App&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">store</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./app/store&#x27;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Provider</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports operator" style="color:#F8F8F2">*</span><span class="token imports"> </span><span class="token imports keyword module" style="color:#F92672">as</span><span class="token imports"> serviceWorker</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./serviceWorker&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">render</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag class-name" style="color:#F92672">Provider</span><span class="token tag" style="color:#F92672"> </span><span class="token tag attr-name" style="color:#a6e22e">store</span><span class="token tag script language-javascript script-punctuation punctuation" style="color:#F8F8F2">=</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">{</span><span class="token tag script language-javascript" style="color:#F92672">store</span><span class="token tag script language-javascript punctuation" style="color:#F8F8F2">}</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token plain-text"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain-text">    </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;</span><span class="token tag class-name" style="color:#F92672">App</span><span class="token tag" style="color:#F92672"> </span><span class="token tag punctuation" style="color:#F8F8F2">/&gt;</span><span class="token plain-text"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain-text">  </span><span class="token tag punctuation" style="color:#F8F8F2">&lt;/</span><span class="token tag class-name" style="color:#F92672">Provider</span><span class="token tag punctuation" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token dom variable" style="color:#F8F8F2">document</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">getElementById</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;root&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>我们总是必须调用 <code>ReactDOM.render(&lt;App /&gt;)</code> 来告诉 React 开始渲染我们的根 <code>&lt;App&gt;</code> 组件。 为了让像 <code>useSelector</code> 这样的 hooks 正常工作，我们需要使用一个名为 <code>&lt;Provider&gt;</code> 的组件在幕后传递 Redux store，以便他们可以访问它。</p><p>我们在这里引用来自 <code>app/store.js</code> 中创建的 store。然后，用 <code>&lt;Provider&gt;</code> 包裹整个 <code>&lt;App&gt;</code>，并传入 store：<code>&lt;Provider store={store}&gt;</code>。</p><p>现在，任何调用 <code>useSelector</code> 或 <code>useDispatch</code> 的 React 组件都可以访问 <code>&lt;Provider&gt;</code> 中的 store。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="你学到了">你学到了<a class="hash-link" href="#你学到了" title="Direct link to heading">​</a></h2><p>尽管 Count 这个应用程序非常小，但它展示了 React + Redux 应用程序协同工作的所有关键部分。 以下是我们介绍的内容：</p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>总结</h5></div><div class="admonition-content"><ul><li><strong>我们可以使用 Redux Toolkit <code>configureStore</code> API 创建一个 Redux store</strong><ul><li><code>configureStore</code> 接收 <code>reducer</code> 函数来作为命名参数</li><li><code>configureStore</code> 自动使用默认值来配置 store</li></ul></li><li><strong>在 slice 文件中编写 Redux 逻辑</strong><ul><li>一个 slice 包含一个特定功能或部分的 state 相关的 reducer 逻辑和 action</li><li>Redux Toolkit 的 <code>createSlice</code> API 为您提供的每个 reducer 函数生成 action creator 和 action 类型</li></ul></li><li><strong>Redux reducer 必须遵循以下原则</strong><ul><li>必须依赖 <code>state</code> 和 <code>action</code> 参数去计算出一个新 state</li><li>必须通过拷贝旧 state 的方式去做 <em>不可变更新</em> (<em>immutable updates</em>)</li><li>不能包含任何异步逻辑或其他副作用</li><li>Redux Toolkit 的 <code>createSlice</code> API 内部使用了 Immer 库才达到表面上直接修改（&quot;mutating&quot;）state 也实现不可变更新（<em>immutable updates</em>）的效果</li></ul></li><li><strong>一般使用 “thunks” 来开发特定的异步逻辑</strong><ul><li>Thunks 接收 <code>dispatch</code> 和 <code>getState</code> 作为参数</li><li>Redux Toolkit 内置并默认启用了 <code>redux-thunk</code> 中间件</li></ul></li><li><strong>使用 React-Redux 来做 React 组件和 Redux store 的通信</strong><ul><li>在应用程序根组件包裹 <code>&lt;Provider store={store}&gt;</code> 使得所有组件都能访问到 store </li><li>全局状态应该维护在 Redux store 内，局部状态应该维护在局部 React 组件内</li></ul></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步">下一步<a class="hash-link" href="#下一步" title="Direct link to heading">​</a></h2><p>现在您已经看到了 Redux 应用程序的所有部分，是时候编写自己的应用程序了！ 在本教程的其余部分，您将构建一个更大的使用 Redux 的示例应用程序。 在此过程中，我们将介绍正确使用 Redux 所需了解的所有关键思想。</p><p>继续阅读 <a href="/tutorials/essentials/part-3-data-flow">第 3 部分：Redux 数据流基础</a> 以开始构建示例应用程序。</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tutorials/essentials/part-1-overview-concepts"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">基础概念</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tutorials/essentials/part-3-data-flow"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">数据流基础</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a></li><li><a href="#计数器示例应用程序" class="table-of-contents__link toc-highlight">计数器示例应用程序</a><ul><li><a href="#使用计数器应用程序" class="table-of-contents__link toc-highlight">使用计数器应用程序</a></li></ul></li><li><a href="#application-实现" class="table-of-contents__link toc-highlight">Application 实现</a><ul><li><a href="#创建-redux-store" class="table-of-contents__link toc-highlight">创建 Redux Store</a></li><li><a href="#创建-slice-reducer-和-action" class="table-of-contents__link toc-highlight">创建 Slice Reducer 和 Action</a></li><li><a href="#reducer-的规则" class="table-of-contents__link toc-highlight">Reducer 的规则</a></li><li><a href="#reducer-与-不可变更新" class="table-of-contents__link toc-highlight">Reducer 与 不可变更新</a></li><li><a href="#用-thunk-编写异步逻辑" class="table-of-contents__link toc-highlight">用 Thunk 编写异步逻辑</a></li><li><a href="#react-counter-组件" class="table-of-contents__link toc-highlight">React Counter 组件</a></li><li><a href="#组件-state-与-表单" class="table-of-contents__link toc-highlight">组件 State 与 表单</a></li><li><a href="#providing-the-store" class="table-of-contents__link toc-highlight">Providing the Store</a></li></ul></li><li><a href="#你学到了" class="table-of-contents__link toc-highlight">你学到了</a></li><li><a href="#下一步" class="table-of-contents__link toc-highlight">下一步</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/essentials/part-1-overview-concepts">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">常见问题</a></li><li class="footer__item"><a class="footer__link-item" href="/api/api-reference">API 文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactiflux Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started#help-and-discussion">Feedback</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2015–2022 Dan Abramov and Cam Song.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.d4659145.js"></script>
<script src="/assets/js/main.770d8f43.js"></script>
</body>
</html>