<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-tutorials/fundamentals/part-6-async-logic">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-66122997-1","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-M7SNC3FDW9"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-M7SNC3FDW9",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Redux 中文官网" href="/opensearch.xml"><title data-rh="true">Redux Fundamentals, Part 6: Async Logic and Data Fetching | Redux 中文官网</title><meta data-rh="true" property="og:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" name="twitter:image" content="http://cn.redux.js.org/img/redux-logo-landscape.png"><meta data-rh="true" property="og:url" content="http://cn.redux.js.org/tutorials/fundamentals/part-6-async-logic"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Redux Fundamentals, Part 6: Async Logic and Data Fetching | Redux 中文官网"><meta data-rh="true" name="description" content="The official Redux Fundamentals tutorial: learn how to use async logic with Redux"><meta data-rh="true" property="og:description" content="The official Redux Fundamentals tutorial: learn how to use async logic with Redux"><link data-rh="true" rel="icon" href="/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="http://cn.redux.js.org/tutorials/fundamentals/part-6-async-logic"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/tutorials/fundamentals/part-6-async-logic" hreflang="en"><link data-rh="true" rel="alternate" href="http://cn.redux.js.org/tutorials/fundamentals/part-6-async-logic" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://BH4D9OD16A-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/assets/css/styles.3dc3b447.css">
<link rel="preload" href="/assets/js/runtime~main.7120cc77.js" as="script">
<link rel="preload" href="/assets/js/main.b48d161c.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Redux 中文官网</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/introduction/getting-started">入门</a><a class="navbar__item navbar__link" href="/tutorials/essentials/part-1-overview-concepts">教程</a><a class="navbar__item navbar__link" href="/api/api-reference">API</a><a class="navbar__item navbar__link" href="/faq">常见问题</a><a class="navbar__item navbar__link" href="/style-guide/style-guide">最佳实践</a><a href="https://www.github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">源码<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/nefe/redux-in-chinese/issues" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">纠错</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/introduction/getting-started">简介</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/tutorials/index">教程</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/index">教程目录</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/tutorials/essentials/part-1-overview-concepts">Redux 循序渐进</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/tutorials/fundamentals/part-1-overview">Redux 深入浅出</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-1-overview">Redux 概览</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-2-concepts-data-flow">Redux 概念与数据流</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-3-state-actions-reducers">State, Actions, and Reducers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-4-store">Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-5-ui-react">UI and React</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/tutorials/fundamentals/part-6-async-logic">Async Logic and Data Fetching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-7-standard-patterns">标准 Redux 模式</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/tutorials/fundamentals/part-8-modern-redux">Modern Redux with Redux Toolkit</a></li></ul></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/recipes/">技巧</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/understanding/thinking-in-redux/motivation">深入理解 Redux</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/faq">常见问题</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/style-guide/">编码规范</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/api/api-reference">API 文档</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/redux-toolkit/overview">Redux Toolkit</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">教程</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Redux 深入浅出</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Async Logic and Data Fetching</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Redux Fundamentals, Part 6: Async Logic and Data Fetching</h1><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>你将学到</h5></div><div class="admonition-content"><ul><li>How the Redux data flow works with async data</li><li>How to use Redux middleware for async logic</li><li>Patterns for handling async request state</li></ul></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Prerequisites</h5></div><div class="admonition-content"><ul><li>Familiarity with using AJAX requests to fetch and update data from a server</li><li>Understanding asynchronous logic in JS, including Promises</li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="简介">简介<a class="hash-link" href="#简介" title="Direct link to heading">​</a></h2><p>In <a href="/tutorials/fundamentals/part-5-ui-react">Part 5: UI and React</a>, we saw how to use the React-Redux library to let our React components interact with a Redux store, including calling <code>useSelector</code> to read Redux state, calling <code>useDispatch</code> to give us access to the <code>dispatch</code> function, and wrapping our app in a <code>&lt;Provider&gt;</code> component to give those hooks access to the store.</p><p>So far, all the data we&#x27;ve worked with has been directly inside of our React+Redux client application. However, most real applications need to work with data from a server, by making HTTP API calls to fetch and save items.</p><p>In this section, we&#x27;ll update our todo app to fetch the todos from an API, and add new todos by saving them to the API.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="example-rest-api-and-client">Example REST API and Client<a class="hash-link" href="#example-rest-api-and-client" title="Direct link to heading">​</a></h3><p>To keep the example project isolated but realistic, the initial project setup already included a fake in-memory REST API for our data (configured using <a href="https://miragejs.com/" target="_blank" rel="noopener noreferrer">the Mirage.js mock API tool</a>). The API uses <code>/fakeApi</code> as the base URL for the endpoints, and supports the typical <code>GET/POST/PUT/DELETE</code> HTTP methods for <code>/fakeApi/todos</code>. It&#x27;s defined in <code>src/api/server.js</code>.</p><p>The project also includes a small HTTP API client object that exposes <code>client.get()</code> and <code>client.post()</code> methods, similar to popular HTTP libraries like <code>axios</code>. It&#x27;s defined in <code>src/api/client.js</code>.</p><p>We&#x27;ll use the <code>client</code> object to make HTTP calls to our in-memory fake REST API for this section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="redux-middleware-and-side-effects">Redux Middleware and Side Effects<a class="hash-link" href="#redux-middleware-and-side-effects" title="Direct link to heading">​</a></h2><p>By itself, a Redux store doesn&#x27;t know anything about async logic. It only knows how to synchronously dispatch actions, update the state by calling the root reducer function, and notify the UI that something has changed. Any asynchronicity has to happen outside the store.</p><p>Earlier, we said that Redux reducers must never contain &quot;side effects&quot;. <strong>A &quot;side effect&quot; is any change to state or behavior that can be seen outside of returning a value from a function</strong>. Some common kinds of side effects are things like:</p><ul><li>Logging a value to the console</li><li>Saving a file</li><li>Setting an async timer</li><li>Making an AJAX HTTP request</li><li>Modifying some state that exists outside of a function, or mutating arguments to a function</li><li>Generating random numbers or unique random IDs (such as <code>Math.random()</code> or <code>Date.now()</code>)</li></ul><p>However, any real app will need to do these kinds of things <em>somewhere</em>. So, if we can&#x27;t put side effects in reducers, where <em>can</em> we put them?</p><p><strong>Redux middleware were designed to enable writing logic that has side effects</strong>.</p><p>As we said <a href="/tutorials/fundamentals/part-4-store#middleware-use-cases">in Part 4</a>, a Redux middleware can do <em>anything</em> when it sees a dispatched action: log something, modify the action, delay the action, make an async call, and more. Also, since middleware form a pipeline around the real <code>store.dispatch</code> function, this also means that we could actually pass something that <em>isn&#x27;t</em> a plain action object to <code>dispatch</code>, as long as a middleware intercepts that value and doesn&#x27;t let it reach the reducers.</p><p>Middleware also have access to <code>dispatch</code> and <code>getState</code>. That means you could write some async logic in a middleware, and still have the ability to interact with the Redux store by dispatching actions.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="using-middleware-to-enable-async-logic">Using Middleware to Enable Async Logic<a class="hash-link" href="#using-middleware-to-enable-async-logic" title="Direct link to heading">​</a></h3><p>Let&#x27;s look at a couple examples of how middleware can enable us to write some kind of async logic that interacts with the Redux store.</p><p>One possibility is writing a middleware that looks for specific action types, and runs async logic when it sees those actions, like these examples:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> client </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../api/client&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">delayedActionMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setTimeout</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Delay this action by one second</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">1000</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">fetchTodosMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/fetchTodos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Make an API call to fetch todos from the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">then</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Dispatch an action with the todos we received</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      storeAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todos </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>For more details on why and how Redux uses middleware for async logic, see these StackOverflow answers by Redux creator Dan Abramov:</p><ul><li><a href="https://stackoverflow.com/questions/35411423/how-to-dispatch-a-redux-action-with-a-timeout/35415559#35415559" target="_blank" rel="noopener noreferrer">&quot;How to dispatch a Redux action with a timeout?&quot;</a></li><li><a href="https://stackoverflow.com/questions/34570758/why-do-we-need-middleware-for-async-flow-in-redux/34599594#34599594" target="_blank" rel="noopener noreferrer">&quot;Why do we need middleware for async flow?&quot;</a></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-an-async-function-middleware">Writing an Async Function Middleware<a class="hash-link" href="#writing-an-async-function-middleware" title="Direct link to heading">​</a></h3><p>Both of the middleware in that last section were very specific and only do one thing. It would be nice if we had a way to write <em>any</em> async logic ahead of time, separate from the middleware itself, and still have access to <code>dispatch</code> and <code>getState</code> so that we can interact with the store.</p><p><strong>What if we wrote a middleware that let us pass a <em>function</em> to <code>dispatch</code>, instead of an action object</strong>? We could have our middleware check to see if the &quot;action&quot; is actually a function instead, and if it&#x27;s a function, call the function right away. That would let us write async logic in separate functions, outside of the middleware definition.</p><p>Here&#x27;s what that middleware might look like:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">Example async function middleware</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">asyncFunctionMiddleware</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">storeAPI</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">next</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token parameter">action</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// If the &quot;action&quot; is actually a function instead...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token keyword" style="color:#F92672">typeof</span><span class="token plain"> action </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;function&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// then call the function and pass `dispatch` and `getState` as arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">action</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">storeAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">dispatch</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> storeAPI</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Otherwise, it&#x27;s a normal action - send it onwards</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">next</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And then we could use that middleware like this:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> middlewareEnhancer </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">applyMiddleware</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">asyncFunctionMiddleware</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> store </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> middlewareEnhancer</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Write a function that has `dispatch` and `getState` as arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">fetchSomeData</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// Make an async HTTP request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">then</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">todos</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Dispatch an action with the todos we received</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> todos </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Check the updated store state after dispatching</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> allTodos </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;Number of todos after loading: &#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> allTodos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Pass the _function_ we wrote to `dispatch`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">fetchSomeData</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// logs: &#x27;Number of todos after loading: ###&#x27;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again, notice that <strong>this &quot;async function middleware&quot; let us pass a <em>function</em> to <code>dispatch</code>!</strong> Inside that function, we were able to write some async logic (an HTTP request), then dispatch a normal action object when the request completed.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="redux-async-data-flow">Redux Async Data Flow<a class="hash-link" href="#redux-async-data-flow" title="Direct link to heading">​</a></h2><p>So how do middleware and async logic affect the overall data flow of a Redux app?</p><p>Just like with a normal action, we first need to handle a user event in the application, such as a click on a button. Then, we call <code>dispatch()</code>, and pass in <em>something</em>, whether it be a plain action object, a function, or some other value that a middleware can look for.</p><p>Once that dispatched value reaches a middleware, it can make an async call, and then dispatch a real action object when the async call completes.</p><p>Earlier, we saw <a href="/tutorials/fundamentals/part-2-concepts-data-flow#redux-application-data-flow">a diagram that represents the normal synchronous Redux data flow</a>. When we add async logic to a Redux app, we add an extra step where middleware can run logic like AJAX requests, then dispatch actions. That makes the async data flow look like this:</p><p><img loading="lazy" alt="Redux async data flow diagram" src="/assets/images/ReduxAsyncDataFlowDiagram-d97ff38a0f4da0f327163170ccc13e80.gif" width="1440" height="1080" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-redux-thunk-middleware">Using the Redux Thunk Middleware<a class="hash-link" href="#using-the-redux-thunk-middleware" title="Direct link to heading">​</a></h2><p>As it turns out, Redux already has an official version of that &quot;async function middleware&quot;, called the <a href="https://github.com/reduxjs/redux-thunk" target="_blank" rel="noopener noreferrer"><strong>Redux &quot;Thunk&quot; middleware</strong></a>. The thunk middleware allows us to write functions that get <code>dispatch</code> and <code>getState</code> as arguments. The thunk functions can have any async logic we want inside, and that logic can dispatch actions and read the store state as needed.</p><p><strong>Writing async logic as thunk functions allows us to reuse that logic without knowing what Redux store we&#x27;re using ahead of time</strong>.</p><div class="admonition admonition-info alert alert--info"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</h5></div><div class="admonition-content"><p>The word &quot;thunk&quot; is a programming term that means <a href="https://en.wikipedia.org/wiki/Thunk" target="_blank" rel="noopener noreferrer">&quot;a piece of code that does some delayed work&quot;</a>. For more details, see these posts:</p><ul><li><a href="https://daveceddia.com/what-is-a-thunk/" target="_blank" rel="noopener noreferrer">What the heck is a thunk?</a></li><li><a href="https://medium.com/fullstack-academy/thunks-in-redux-the-basics-85e538a3fe60" target="_blank" rel="noopener noreferrer">Thunks in Redux: the basics</a></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-the-store">Configuring the Store<a class="hash-link" href="#configuring-the-store" title="Direct link to heading">​</a></h3><p>The Redux thunk middleware is available on NPM as a package called <code>redux-thunk</code>. We need to install that package to use it in our app:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token function" style="color:#E6D874">npm</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">install</span><span class="token plain"> redux-thunk</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once it&#x27;s installed, we can update the Redux store in our todo app to use that middleware:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/store.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> createStore</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> applyMiddleware </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;redux&#x27;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">thunkMiddleware</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;redux-thunk&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> composeWithDevTools </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;redux-devtools-extension&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">rootReducer</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./reducer&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> composedEnhancer </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">composeWithDevTools</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">applyMiddleware</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">thunkMiddleware</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// The store now has the ability to accept thunk functions in `dispatch`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> store </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">createStore</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">rootReducer</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> composedEnhancer</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> store</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="fetching-todos-from-a-server">Fetching Todos from a Server<a class="hash-link" href="#fetching-todos-from-a-server" title="Direct link to heading">​</a></h3><p>Right now our todo entries can only exist in the client&#x27;s browser. We need a way to load a list of todos from the server when the app starts up.</p><p>We&#x27;ll start by writing a thunk function that makes an AJAX call to our <code>/fakeApi/todos</code> endpoint to request an array of todo objects, and then dispatch an action containing that array as the payload. Since this is related to the todos feature in general, we&#x27;ll write the thunk function in the <code>todosSlice.js</code> file:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/todos/todosSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> client </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../../api/client&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// omit reducer logic</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token comment" style="color:#c6cad2">// Thunk function</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We only want to make this API call once, when the application loads for the first time. There&#x27;s a few places we <em>could</em> put this:</p><ul><li>In the <code>&lt;App&gt;</code> component, in a <code>useEffect</code> hook</li><li>In the <code>&lt;TodoList&gt;</code> component, in a <code>useEffect</code> hook</li><li>In the <code>index.js</code> file directly, right after we import the store</li></ul><p>For now, let&#x27;s try putting this directly in <code>index.js</code>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/index.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">ReactDOM</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-dom&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> </span><span class="token imports maybe-class-name">Provider</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./index.css&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">App</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./App&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./api/server&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports">store</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./store&#x27;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> fetchTodos </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;./features/todos/todosSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token maybe-class-name">ReactDOM</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">render</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">StrictMode</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">Provider</span><span class="token plain"> store</span><span class="token operator" style="color:#F8F8F2">=</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain">store</span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token maybe-class-name">App</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">/</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token maybe-class-name">Provider</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token operator" style="color:#F8F8F2">&lt;</span><span class="token operator" style="color:#F8F8F2">/</span><span class="token maybe-class-name">React</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access maybe-class-name">StrictMode</span><span class="token operator" style="color:#F8F8F2">&gt;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token dom variable" style="color:#F8F8F2">document</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">getElementById</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;root&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we reload the page, there&#x27;s no visible change in the UI. However, if we open up the Redux DevTools extension, we should now see that a <code>&#x27;todos/todosLoaded&#x27;</code> action was dispatched, and it should contain some todo objects that were generated by our fake server API:</p><p><img loading="lazy" alt="Devtools - todosLoaded action contents" src="/assets/images/devtools-todosLoaded-action-0f8f36d9f37404a85e5cbc20bd30d9e4.png" width="1640" height="506" class="img_ev3q"></p><p>Notice that even though we&#x27;ve dispatched an action, nothing&#x27;s happening to change the state. <strong>We need to handle this action in our todos reducer to have the state updated.</strong></p><p>Let&#x27;s add a case to the reducer to load this data into the store. Since we&#x27;re fetching the data from the server, we want to completely replace any existing todos, so we can return the <code>action.payload</code> array to make it be the new todos <code>state</code> value:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/todos/todosSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> client </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../../api/client&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// omit other reducer cases</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Replace the existing state entirely by returning the new value</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since dispatching an action immediately updates the store, we can also call <code>getState</code> in the thunk to read the updated state value after we dispatch. For example, we could log the number of total todos to the console before and after dispatching the <code>&#x27;todos/todosLoaded&#x27;</code> action:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">fetchTodos</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">get</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> stateBefore </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;Todos before dispatch: &#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> stateBefore</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todosLoaded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> stateAfter </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">getState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token console class-name">console</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">log</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;Todos after dispatch: &#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> stateAfter</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todos</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saving-todo-items">Saving Todo Items<a class="hash-link" href="#saving-todo-items" title="Direct link to heading">​</a></h3><p>We also need to update the server whenever we try to create a new todo item. Instead of dispatching the <code>&#x27;todos/todoAdded&#x27;</code> action right away, we should make an API call to the server with the initial data, wait for the server to send back a copy of the newly saved todo item, and <em>then</em> dispatch an action with that todo item.</p><p>However, if we start trying to write this logic as a thunk function, we&#x27;re going to run into a problem: since we&#x27;re writing the thunk as a separate function in the <code>todosSlice.js</code> file, the code that makes the API call doesn&#x27;t know what the new todo text is supposed to be:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/todos/todosSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// ❌ We need to have the text of the new todo, but where is it coming from?</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">post</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">todo</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todo</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We need a way to write one function that accepts <code>text</code> as its parameter, but then creates the actual thunk function so that it can use the <code>text</code> value to make the API call. Our outer function should then return the thunk function so that we can pass to <code>dispatch</code> in our component.</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/todos/todosSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token comment" style="color:#c6cad2">// Write a synchronous outer function that receives the `text` parameter:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">text</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// And then creates and returns the async thunk function:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">async</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodoThunk</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">dispatch</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> getState</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// ✅ Now we can use the text value and send it to the server</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialTodo </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> text </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> response </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:#F92672">await</span><span class="token plain"> client</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">post</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;/fakeApi/todos&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">todo</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> initialTodo </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">type</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> </span><span class="token literal-property property" style="color:#F92672">payload</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">todo</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can use this in our <code>&lt;Header&gt;</code> component:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/header/Header.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports maybe-class-name">React</span><span class="token imports punctuation" style="color:#F8F8F2">,</span><span class="token imports"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useState </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> useDispatch </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;react-redux&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">import</span><span class="token plain"> </span><span class="token imports punctuation" style="color:#F8F8F2">{</span><span class="token imports"> saveNewTodo </span><span class="token imports punctuation" style="color:#F8F8F2">}</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">from</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;../todos/todosSlice&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function maybe-class-name" style="color:#E6D874">Header</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token plain">text</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> setText</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useState</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> dispatch </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">useDispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">handleChange</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">setText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">value</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">handleKeyDown</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// If the user pressed the Enter key:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> trimmedText </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">trim</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">which</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">13</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Create the thunk function with the text the user wrote</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> saveNewTodoThunk </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Then dispatch the thunk function itself</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">saveNewTodoThunk</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token function" style="color:#E6D874">setText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// omit rendering output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since we know we&#x27;re going to immediately pass the thunk function to <code>dispatch</code> in the
component, we can skip creating the temporary variable. Instead, we can call <code>saveNewTodo(text)</code>, and pass the resulting thunk function straight to <code>dispatch</code>:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/header/Header.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> </span><span class="token function-variable function" style="color:#E6D874">handleKeyDown</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token parameter">e</span><span class="token plain"> </span><span class="token arrow operator" style="color:#F8F8F2">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token comment" style="color:#c6cad2">// If the user pressed the Enter key:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> trimmedText </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> text</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token method function property-access" style="color:#E6D874">trim</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">which</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">===</span><span class="token plain"> </span><span class="token number" style="color:#AE81FF">13</span><span class="token plain"> </span><span class="token operator" style="color:#F8F8F2">&amp;&amp;</span><span class="token plain"> trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// Create the thunk function and immediately dispatch it</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">dispatch</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token function" style="color:#E6D874">saveNewTodo</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">trimmedText</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token function" style="color:#E6D874">setText</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token string" style="color:#a6e22e">&#x27;&#x27;</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now the component doesn&#x27;t actually know that it&#x27;s even dispatching a thunk function - the <code>saveNewTodo</code> function is encapsulating what&#x27;s actually happening. The <code>&lt;Header&gt;</code> component only knows that it needs to dispatch <em>some value</em> when the user presses enter.</p><p>This pattern of writing a function to prepare something that will get passed to <code>dispatch</code> is called <strong>the &quot;action creator&quot; pattern</strong>, and we&#x27;ll talk about that more in <a href="/tutorials/fundamentals/part-7-standard-patterns">the next section</a>.</p><p>We can now see the updated <code>&#x27;todos/todoAdded&#x27;</code> action being dispatched:</p><p><img loading="lazy" alt="Devtools - async todoAdded action contents" src="/assets/images/devtools-async-todoAdded-action-b3eac966d8c8110fc96f4b810c945861.png" width="1640" height="395" class="img_ev3q"></p><p>The last thing we need to change here is updating our todos reducer. When we make a POST request to <code>/fakeApi/todos</code>, the server will return a completely new todo object (including a new ID value). That means our reducer doesn&#x27;t have to calculate a new ID, or fill out the other fields - it only needs to create a new <code>state</code> array that includes the new todo item:</p><div class="language-js codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockTitle_Ktv7">src/features/todos/todosSlice.js</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-js codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token keyword" style="color:#F92672">const</span><span class="token plain"> initialState </span><span class="token operator" style="color:#F8F8F2">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token keyword module" style="color:#F92672">export</span><span class="token plain"> </span><span class="token keyword module" style="color:#F92672">default</span><span class="token plain"> </span><span class="token keyword" style="color:#F92672">function</span><span class="token plain"> </span><span class="token function" style="color:#E6D874">todosReducer</span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token parameter">state </span><span class="token parameter operator" style="color:#F8F8F2">=</span><span class="token parameter"> initialState</span><span class="token parameter punctuation" style="color:#F8F8F2">,</span><span class="token parameter"> action</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token keyword control-flow" style="color:#F92672">switch</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">(</span><span class="token plain">action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">type</span><span class="token punctuation" style="color:#F8F8F2">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword" style="color:#F92672">case</span><span class="token plain"> </span><span class="token string" style="color:#a6e22e">&#x27;todos/todoAdded&#x27;</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token comment" style="color:#c6cad2">// Return a new todos state array with the new todo item at the end</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#F8F8F2">[</span><span class="token spread operator" style="color:#F8F8F2">...</span><span class="token plain">state</span><span class="token punctuation" style="color:#F8F8F2">,</span><span class="token plain"> action</span><span class="token punctuation" style="color:#F8F8F2">.</span><span class="token property-access">payload</span><span class="token punctuation" style="color:#F8F8F2">]</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token comment" style="color:#c6cad2">// omit other cases</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">    </span><span class="token keyword module" style="color:#F92672">default</span><span class="token operator" style="color:#F8F8F2">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">      </span><span class="token keyword control-flow" style="color:#F92672">return</span><span class="token plain"> state</span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">  </span><span class="token punctuation" style="color:#F8F8F2">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain"></span><span class="token punctuation" style="color:#F8F8F2">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And now adding a new todo will work correctly:</p><p><img loading="lazy" alt="Devtools - async todoAdded state diff" src="/assets/images/devtools-async-todoAdded-diff-5f18f236969280dec2dad1a6d4d74b2e.png" width="1640" height="274" class="img_ev3q"></p><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</h5></div><div class="admonition-content"><p>Thunk functions can be used for both asynchronous <em>and</em> synchronous logic. Thunks provide a way to write any reusable logic that needs access to <code>dispatch</code> and <code>getState</code>.</p></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="你学到了">你学到了<a class="hash-link" href="#你学到了" title="Direct link to heading">​</a></h2><p>We&#x27;ve now succesfully updated our todo app so that we can fetch a list of todo items and save new todo items, using &quot;thunk&quot; functions to make the AJAX calls to our fake server API.</p><p>In the process, we saw how Redux middleware are used to let us make async calls and interact with the store by dispatching actions with after the async calls have completed.</p><p>Here&#x27;s what the current app looks like:</p><iframe class="codesandbox" src="https://codesandbox.io/embed/github/reduxjs/redux-fundamentals-example-app/tree/checkpoint-6-asyncThunks/?fontsize=14&amp;hidenavigation=1&amp;theme=dark&amp;runonclick=1" title="redux-fundamentals-example-app" allow="geolocation; microphone; camera; midi; vr; accelerometer; gyroscope; payment; ambient-light-sensor; encrypted-media; usb" sandbox="allow-modals allow-forms allow-popups allow-scripts allow-same-origin"></iframe><div class="admonition admonition-tip alert alert--success"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>总结</h5></div><div class="admonition-content"><ul><li><strong>Redux middleware were designed to enable writing logic that has side effects</strong><ul><li>&quot;Side effects&quot; are code that changes state/behavior outside a function, like AJAX calls, modifying function arguments, or generating random values</li></ul></li><li><strong>Middleware add an extra step to the standard Redux data flow</strong><ul><li>Middleware can intercept other values passed to <code>dispatch</code></li><li>Middleware have access to <code>dispatch</code> and <code>getState</code>, so they can dispatch more actions as part of async logic</li></ul></li><li><strong>The Redux &quot;Thunk&quot; middleware lets us pass functions to <code>dispatch</code></strong><ul><li>&quot;Thunk&quot; functions let us write async logic ahead of time, without knowing what Redux store is being used</li><li>A Redux thunk function receives <code>dispatch</code> and <code>getState</code> as arguments, and can dispatch actions like &quot;this data was received from an API response&quot;</li></ul></li></ul></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="下一步">下一步<a class="hash-link" href="#下一步" title="Direct link to heading">​</a></h2><p>We&#x27;ve now covered all the core pieces of how to use Redux! You&#x27;ve seen how to:</p><ul><li>Write reducers that update state based on dispatched actions,</li><li>Create and configure a Redux store with a reducer, enhancers, and middleware</li><li>Use middleware to write async logic that dispatches actions</li></ul><p>In <a href="/tutorials/fundamentals/part-7-standard-patterns">Part 7: Standard Redux Patterns</a>, we&#x27;ll look at several code patterns that are typically used by real-world Redux apps to make our code more consistent and scale better as the application grows.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/tutorials/fundamentals/part-5-ui-react"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">UI and React</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/tutorials/fundamentals/part-7-standard-patterns"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">标准 Redux 模式</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#简介" class="table-of-contents__link toc-highlight">简介</a><ul><li><a href="#example-rest-api-and-client" class="table-of-contents__link toc-highlight">Example REST API and Client</a></li></ul></li><li><a href="#redux-middleware-and-side-effects" class="table-of-contents__link toc-highlight">Redux Middleware and Side Effects</a><ul><li><a href="#using-middleware-to-enable-async-logic" class="table-of-contents__link toc-highlight">Using Middleware to Enable Async Logic</a></li><li><a href="#writing-an-async-function-middleware" class="table-of-contents__link toc-highlight">Writing an Async Function Middleware</a></li></ul></li><li><a href="#redux-async-data-flow" class="table-of-contents__link toc-highlight">Redux Async Data Flow</a></li><li><a href="#using-the-redux-thunk-middleware" class="table-of-contents__link toc-highlight">Using the Redux Thunk Middleware</a><ul><li><a href="#configuring-the-store" class="table-of-contents__link toc-highlight">Configuring the Store</a></li><li><a href="#fetching-todos-from-a-server" class="table-of-contents__link toc-highlight">Fetching Todos from a Server</a></li><li><a href="#saving-todo-items" class="table-of-contents__link toc-highlight">Saving Todo Items</a></li></ul></li><li><a href="#你学到了" class="table-of-contents__link toc-highlight">你学到了</a></li><li><a href="#下一步" class="table-of-contents__link toc-highlight">下一步</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started">入门</a></li><li class="footer__item"><a class="footer__link-item" href="/tutorials/essentials/part-1-overview-concepts">教程</a></li><li class="footer__item"><a class="footer__link-item" href="/faq">常见问题</a></li><li class="footer__item"><a class="footer__link-item" href="/api/api-reference">API 文档</a></li></ul></div><div class="col footer__col"><div class="footer__title">社区</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/0ZcbPKXt5bZ6au5t" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reactiflux Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="http://stackoverflow.com/questions/tagged/redux" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/introduction/getting-started#help-and-discussion">Feedback</a></li></ul></div><div class="col footer__col"><div class="footer__title">更多</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/nefe/redux-in-chinese" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item">
                <a href="https://www.netlify.com">
                  <img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify">
                </a>
              </li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://redux.js.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/img/redux.svg" alt="Redux Logo" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">Copyright © 2015–2022 Dan Abramov and Cam Song.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.7120cc77.js"></script>
<script src="/assets/js/main.b48d161c.js"></script>
</body>
</html>